<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tesla LibreTV ç»¼åˆæµ‹è¯•å¥—ä»¶</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .test-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .test-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
        }

        .test-card h3 {
            color: #2d3748;
            font-size: 1.4rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .test-card .icon {
            font-size: 1.5rem;
        }

        .test-card p {
            color: #718096;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .test-features {
            list-style: none;
            margin-bottom: 20px;
        }

        .test-features li {
            color: #4a5568;
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }

        .test-features li:before {
            content: 'âœ“';
            position: absolute;
            left: 0;
            color: #48bb78;
            font-weight: bold;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn.secondary {
            background: #e2e8f0;
            color: #4a5568;
            margin-top: 10px;
        }

        .btn.secondary:hover {
            background: #cbd5e0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .status-panel {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .status-item {
            text-align: center;
            padding: 20px;
            background: #f7fafc;
            border-radius: 8px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .status-item.online {
            border-color: #48bb78;
            background: #f0fff4;
        }

        .status-item.offline {
            border-color: #f56565;
            background: #fffafa;
        }

        .status-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .status-label {
            color: #718096;
            font-size: 0.9rem;
        }

        .quick-actions {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .quick-actions h3 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }

        .action-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .action-btn {
            padding: 15px;
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 0.9rem;
            color: #4a5568;
        }

        .action-btn:hover {
            border-color: #667eea;
            background: #edf2f7;
            color: #667eea;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal h3 {
            color: #2d3748;
            margin-bottom: 20px;
        }

        .close {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #a0aec0;
        }

        .close:hover {
            color: #2d3748;
        }

        .log-container {
            background: #1a202c;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #48bb78, #38a169);
            width: 0%;
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            .test-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .container {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš— Tesla LibreTV ç»¼åˆæµ‹è¯•å¥—ä»¶</h1>
            <p>åœ¨PCç«¯å®Œæˆå…¨é¢çš„æµ‹è¯•ã€ä¼˜åŒ–å’Œè´¨é‡æ£€æŸ¥å·¥ä½œ</p>
        </div>

        <!-- ç³»ç»ŸçŠ¶æ€é¢æ¿ -->
        <div class="status-panel">
            <h3>ğŸ” ç³»ç»ŸçŠ¶æ€ç›‘æ§</h3>
            <div class="status-grid">
                <div class="status-item" id="proxyStatus">
                    <div class="status-value">æ£€æµ‹ä¸­...</div>
                    <div class="status-label">ä»£ç†æœåŠ¡å™¨</div>
                </div>
                <div class="status-item" id="webrtcStatus">
                    <div class="status-value">æ£€æµ‹ä¸­...</div>
                    <div class="status-label">WebRTCæ”¯æŒ</div>
                </div>
                <div class="status-item" id="networkStatus">
                    <div class="status-value">æ£€æµ‹ä¸­...</div>
                    <div class="status-label">ç½‘ç»œè¿æ¥</div>
                </div>
                <div class="status-item" id="browserStatus">
                    <div class="status-value">æ£€æµ‹ä¸­...</div>
                    <div class="status-label">æµè§ˆå™¨å…¼å®¹æ€§</div>
                </div>
            </div>
        </div>

        <!-- æµ‹è¯•å·¥å…·ç½‘æ ¼ -->
        <div class="test-grid">
            <!-- è‡ªåŠ¨åŒ–æµ‹è¯• -->
            <div class="test-card">
                <h3><span class="icon">ğŸ¤–</span>è‡ªåŠ¨åŒ–æµ‹è¯•</h3>
                <p>æ¨¡æ‹Ÿç‰¹æ–¯æ‹‰è½¦æœºç¯å¢ƒï¼Œè‡ªåŠ¨æµ‹è¯•å„ç§è§†é¢‘æ’­æ”¾æ–¹æ¡ˆçš„å…¼å®¹æ€§å’Œæ€§èƒ½è¡¨ç°ã€‚</p>
                <ul class="test-features">
                    <li>æ¨¡æ‹Ÿå¤šç§ç‰¹æ–¯æ‹‰è½¦å‹ç¯å¢ƒ</li>
                    <li>è‡ªåŠ¨æµ‹è¯•WebRTCå’Œä»£ç†æ–¹æ¡ˆ</li>
                    <li>æ™ºèƒ½é™çº§å’Œæ•…éšœæ¢å¤æµ‹è¯•</li>
                    <li>ç”Ÿæˆè¯¦ç»†æµ‹è¯•æŠ¥å‘Š</li>
                </ul>
                <button class="btn" onclick="openTestTool('tesla-test-runner.html')">å¯åŠ¨è‡ªåŠ¨åŒ–æµ‹è¯•</button>
                <button class="btn secondary" onclick="showTestConfig()">é…ç½®æµ‹è¯•å‚æ•°</button>
            </div>

            <!-- æ€§èƒ½åŸºå‡†æµ‹è¯• -->
            <div class="test-card">
                <h3><span class="icon">âš¡</span>æ€§èƒ½åŸºå‡†æµ‹è¯•</h3>
                <p>å¯¹æ¯”ä¸åŒæ’­æ”¾æ–¹æ¡ˆçš„æ€§èƒ½æŒ‡æ ‡ï¼Œæ‰¾å‡ºæœ€ä¼˜çš„æ’­æ”¾ç­–ç•¥å’Œé…ç½®ã€‚</p>
                <ul class="test-features">
                    <li>åŠ è½½æ—¶é—´å’Œé¦–å¸§æ—¶é—´æµ‹è¯•</li>
                    <li>å†…å­˜å’ŒCPUä½¿ç”¨ç‡ç›‘æ§</li>
                    <li>ç½‘ç»œå¸¦å®½å’Œç¼“å†²åˆ†æ</li>
                    <li>æ’­æ”¾è´¨é‡è¯„ä¼°</li>
                </ul>
                <button class="btn" onclick="openTestTool('performance-benchmark-dashboard.html')">å¯åŠ¨æ€§èƒ½æµ‹è¯•</button>
                <button class="btn secondary" onclick="showBenchmarkConfig()">é…ç½®åŸºå‡†å‚æ•°</button>
            </div>

            <!-- ä»£ç è´¨é‡æ£€æŸ¥ -->
            <div class="test-card">
                <h3><span class="icon">ğŸ”</span>ä»£ç è´¨é‡æ£€æŸ¥</h3>
                <p>åˆ†æä»£ç è´¨é‡ã€å®‰å…¨æ€§å’ŒTeslaå…¼å®¹æ€§ï¼Œæä¾›ä¼˜åŒ–å»ºè®®å’Œæœ€ä½³å®è·µã€‚</p>
                <ul class="test-features">
                    <li>ä»£ç è´¨é‡å’Œå¤æ‚åº¦åˆ†æ</li>
                    <li>å®‰å…¨æ¼æ´æ£€æµ‹</li>
                    <li>Teslaå…¼å®¹æ€§æ£€æŸ¥</li>
                    <li>æ€§èƒ½ä¼˜åŒ–å»ºè®®</li>
                </ul>
                <button class="btn" onclick="openTestTool('code-quality-dashboard.html')">å¯åŠ¨è´¨é‡æ£€æŸ¥</button>
                <button class="btn secondary" onclick="showQualityConfig()">é…ç½®æ£€æŸ¥è§„åˆ™</button>
            </div>

            <!-- ç½‘ç»œè¯Šæ–­å·¥å…· -->
            <div class="test-card">
                <h3><span class="icon">ğŸŒ</span>ç½‘ç»œè¯Šæ–­å·¥å…·</h3>
                <p>è¯Šæ–­ç½‘ç»œè¿æ¥é—®é¢˜ï¼Œæµ‹è¯•ä»£ç†æœåŠ¡å™¨æ€§èƒ½ï¼Œä¼˜åŒ–ç½‘ç»œé…ç½®ã€‚</p>
                <ul class="test-features">
                    <li>ä»£ç†æœåŠ¡å™¨è¿é€šæ€§æµ‹è¯•</li>
                    <li>ç½‘ç»œå»¶è¿Ÿå’Œå¸¦å®½æµ‹è¯•</li>
                    <li>DNSè§£æå’Œè·¯ç”±åˆ†æ</li>
                    <li>é˜²ç«å¢™å’Œç«¯å£æ£€æµ‹</li>
                </ul>
                <button class="btn" onclick="runNetworkDiagnostics()">å¯åŠ¨ç½‘ç»œè¯Šæ–­</button>
                <button class="btn secondary" onclick="showNetworkConfig()">é…ç½®ç½‘ç»œå‚æ•°</button>
            </div>
        </div>

        <!-- å¿«é€Ÿæ“ä½œé¢æ¿ -->
        <div class="quick-actions">
            <h3>âš¡ å¿«é€Ÿæ“ä½œ</h3>
            <div class="action-grid">
                <div class="action-btn" onclick="checkProxyServer()">
                    <div>ğŸ”—</div>
                    <div>æ£€æŸ¥ä»£ç†æœåŠ¡å™¨</div>
                </div>
                <div class="action-btn" onclick="testWebRTC()">
                    <div>ğŸ“¹</div>
                    <div>æµ‹è¯•WebRTC</div>
                </div>
                <div class="action-btn" onclick="generateReport()">
                    <div>ğŸ“Š</div>
                    <div>ç”Ÿæˆç»¼åˆæŠ¥å‘Š</div>
                </div>
                <div class="action-btn" onclick="exportConfig()">
                    <div>âš™ï¸</div>
                    <div>å¯¼å‡ºé…ç½®</div>
                </div>
                <div class="action-btn" onclick="clearCache()">
                    <div>ğŸ—‘ï¸</div>
                    <div>æ¸…ç†ç¼“å­˜</div>
                </div>
                <div class="action-btn" onclick="showHelp()">
                    <div>â“</div>
                    <div>å¸®åŠ©æ–‡æ¡£</div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ¨¡æ€æ¡† -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h3 id="modalTitle">æ ‡é¢˜</h3>
            <div id="modalBody">å†…å®¹</div>
        </div>
    </div>

    <script>
        class TeslaTestSuite {
            constructor() {
                this.init();
            }

            async init() {
                await this.checkSystemStatus();
                this.setupEventListeners();
                this.log('Tesla LibreTV æµ‹è¯•å¥—ä»¶å·²åˆå§‹åŒ–');
            }

            async checkSystemStatus() {
                // æ£€æŸ¥ä»£ç†æœåŠ¡å™¨
                try {
                    const proxyResponse = await fetch('http://localhost:3001/api/health');
                    this.updateStatus('proxyStatus', proxyResponse.ok ? 'åœ¨çº¿' : 'ç¦»çº¿', proxyResponse.ok);
                } catch (error) {
                    this.updateStatus('proxyStatus', 'ç¦»çº¿', false);
                }

                // æ£€æŸ¥WebRTCæ”¯æŒ
                const webrtcSupported = !!(window.RTCPeerConnection || window.webkitRTCPeerConnection || window.mozRTCPeerConnection);
                this.updateStatus('webrtcStatus', webrtcSupported ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ', webrtcSupported);

                // æ£€æŸ¥ç½‘ç»œè¿æ¥
                const networkOnline = navigator.onLine;
                this.updateStatus('networkStatus', networkOnline ? 'å·²è¿æ¥' : 'ç¦»çº¿', networkOnline);

                // æ£€æŸ¥æµè§ˆå™¨å…¼å®¹æ€§
                const browserCompatible = this.checkBrowserCompatibility();
                this.updateStatus('browserStatus', browserCompatible ? 'å…¼å®¹' : 'ä¸å…¼å®¹', browserCompatible);
            }

            updateStatus(elementId, value, isOnline) {
                const element = document.getElementById(elementId);
                element.querySelector('.status-value').textContent = value;
                element.className = `status-item ${isOnline ? 'online' : 'offline'}`;
            }

            checkBrowserCompatibility() {
                // æ£€æŸ¥å…³é”®APIæ”¯æŒ
                return !!(window.fetch && window.Promise && window.WebSocket && window.MediaSource);
            }

            setupEventListeners() {
                // ç›‘å¬ç½‘ç»œçŠ¶æ€å˜åŒ–
                window.addEventListener('online', () => {
                    this.updateStatus('networkStatus', 'å·²è¿æ¥', true);
                    this.log('ç½‘ç»œè¿æ¥å·²æ¢å¤');
                });

                window.addEventListener('offline', () => {
                    this.updateStatus('networkStatus', 'ç¦»çº¿', false);
                    this.log('ç½‘ç»œè¿æ¥å·²æ–­å¼€', 'warning');
                });
            }

            log(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                console.log(`[${timestamp}] ${message}`);
            }
        }

        // å·¥å…·å‡½æ•°
        function openTestTool(url) {
            window.open(url, '_blank', 'width=1200,height=800');
        }

        function showModal(title, content) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalBody').innerHTML = content;
            document.getElementById('modal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        function showTestConfig() {
            const content = `
                <p>é…ç½®è‡ªåŠ¨åŒ–æµ‹è¯•å‚æ•°ï¼š</p>
                <div style="margin: 15px 0;">
                    <label>æµ‹è¯•ç¯å¢ƒï¼š</label>
                    <select style="width: 100%; padding: 8px; margin-top: 5px;">
                        <option>Tesla Model S</option>
                        <option>Tesla Model 3</option>
                        <option>Tesla Model Y</option>
                        <option>Tesla Cybertruck</option>
                    </select>
                </div>
                <div style="margin: 15px 0;">
                    <label>æµ‹è¯•åœºæ™¯ï¼š</label>
                    <select style="width: 100%; padding: 8px; margin-top: 5px;">
                        <option>åŸºç¡€å…¼å®¹æ€§æµ‹è¯•</option>
                        <option>é«˜çº§åŠŸèƒ½æµ‹è¯•</option>
                        <option>æ€§èƒ½å‹åŠ›æµ‹è¯•</option>
                        <option>ç½‘ç»œå¼¹æ€§æµ‹è¯•</option>
                        <option>å®Œæ•´æµ‹è¯•å¥—ä»¶</option>
                    </select>
                </div>
                <button class="btn" style="margin-top: 15px;" onclick="closeModal()">ä¿å­˜é…ç½®</button>
            `;
            showModal('è‡ªåŠ¨åŒ–æµ‹è¯•é…ç½®', content);
        }

        function showBenchmarkConfig() {
            const content = `
                <p>é…ç½®æ€§èƒ½åŸºå‡†æµ‹è¯•å‚æ•°ï¼š</p>
                <div style="margin: 15px 0;">
                    <label>æµ‹è¯•æ¬¡æ•°ï¼š</label>
                    <input type="number" value="3" min="1" max="10" style="width: 100%; padding: 8px; margin-top: 5px;">
                </div>
                <div style="margin: 15px 0;">
                    <label>è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ï¼š</label>
                    <input type="number" value="30" min="10" max="120" style="width: 100%; padding: 8px; margin-top: 5px;">
                </div>
                <div style="margin: 15px 0;">
                    <label>æµ‹è¯•è§†é¢‘ï¼š</label>
                    <select style="width: 100%; padding: 8px; margin-top: 5px;">
                        <option>çŸ­ç‰‡æµ‹è¯•ï¼ˆ30ç§’ï¼‰</option>
                        <option>ä¸­ç­‰é•¿åº¦ï¼ˆ5åˆ†é’Ÿï¼‰</option>
                        <option>é•¿ç‰‡æµ‹è¯•ï¼ˆ30åˆ†é’Ÿï¼‰</option>
                        <option>é«˜è´¨é‡è§†é¢‘</option>
                    </select>
                </div>
                <button class="btn" style="margin-top: 15px;" onclick="closeModal()">ä¿å­˜é…ç½®</button>
            `;
            showModal('æ€§èƒ½åŸºå‡†æµ‹è¯•é…ç½®', content);
        }

        function showQualityConfig() {
            const content = `
                <p>é…ç½®ä»£ç è´¨é‡æ£€æŸ¥è§„åˆ™ï¼š</p>
                <div style="margin: 15px 0;">
                    <label><input type="checkbox" checked> æ€§èƒ½ä¼˜åŒ–æ£€æŸ¥</label><br>
                    <label><input type="checkbox" checked> å®‰å…¨æ¼æ´æ‰«æ</label><br>
                    <label><input type="checkbox" checked> Teslaå…¼å®¹æ€§æ£€æŸ¥</label><br>
                    <label><input type="checkbox" checked> ä»£ç å¤æ‚åº¦åˆ†æ</label><br>
                    <label><input type="checkbox"> ä¸¥æ ¼æ¨¡å¼æ£€æŸ¥</label>
                </div>
                <div style="margin: 15px 0;">
                    <label>æ£€æŸ¥æ·±åº¦ï¼š</label>
                    <select style="width: 100%; padding: 8px; margin-top: 5px;">
                        <option>å¿«é€Ÿæ£€æŸ¥</option>
                        <option selected>æ ‡å‡†æ£€æŸ¥</option>
                        <option>æ·±åº¦æ£€æŸ¥</option>
                    </select>
                </div>
                <button class="btn" style="margin-top: 15px;" onclick="closeModal()">ä¿å­˜é…ç½®</button>
            `;
            showModal('ä»£ç è´¨é‡æ£€æŸ¥é…ç½®', content);
        }

        function showNetworkConfig() {
            const content = `
                <p>é…ç½®ç½‘ç»œè¯Šæ–­å‚æ•°ï¼š</p>
                <div style="margin: 15px 0;">
                    <label>ä»£ç†æœåŠ¡å™¨åœ°å€ï¼š</label>
                    <input type="text" value="http://localhost:3001" style="width: 100%; padding: 8px; margin-top: 5px;">
                </div>
                <div style="margin: 15px 0;">
                    <label>æµ‹è¯•è¶…æ—¶ï¼ˆç§’ï¼‰ï¼š</label>
                    <input type="number" value="10" min="5" max="60" style="width: 100%; padding: 8px; margin-top: 5px;">
                </div>
                <div style="margin: 15px 0;">
                    <label>å¹¶å‘è¿æ¥æ•°ï¼š</label>
                    <input type="number" value="5" min="1" max="20" style="width: 100%; padding: 8px; margin-top: 5px;">
                </div>
                <button class="btn" style="margin-top: 15px;" onclick="closeModal()">ä¿å­˜é…ç½®</button>
            `;
            showModal('ç½‘ç»œè¯Šæ–­é…ç½®', content);
        }

        async function checkProxyServer() {
            const content = `
                <p>æ­£åœ¨æ£€æŸ¥ä»£ç†æœåŠ¡å™¨çŠ¶æ€...</p>
                <div class="progress-bar">
                    <div class="progress-fill" id="proxyProgress"></div>
                </div>
                <div class="log-container" id="proxyLog">å¼€å§‹æ£€æŸ¥ä»£ç†æœåŠ¡å™¨...</div>
            `;
            showModal('ä»£ç†æœåŠ¡å™¨æ£€æŸ¥', content);
            
            // æ¨¡æ‹Ÿæ£€æŸ¥è¿‡ç¨‹
            const log = document.getElementById('proxyLog');
            const progress = document.getElementById('proxyProgress');
            
            const steps = [
                { msg: 'æ£€æŸ¥æœåŠ¡å™¨è¿é€šæ€§...', progress: 25 },
                { msg: 'æµ‹è¯•APIç«¯ç‚¹...', progress: 50 },
                { msg: 'éªŒè¯ä»£ç†åŠŸèƒ½...', progress: 75 },
                { msg: 'æ£€æŸ¥å®Œæˆï¼', progress: 100 }
            ];
            
            for (const step of steps) {
                await new Promise(resolve => setTimeout(resolve, 1000));
                log.innerHTML += `\n${step.msg}`;
                progress.style.width = `${step.progress}%`;
                log.scrollTop = log.scrollHeight;
            }
        }

        async function testWebRTC() {
            const content = `
                <p>æ­£åœ¨æµ‹è¯•WebRTCåŠŸèƒ½...</p>
                <div class="progress-bar">
                    <div class="progress-fill" id="webrtcProgress"></div>
                </div>
                <div class="log-container" id="webrtcLog">å¼€å§‹WebRTCæµ‹è¯•...</div>
            `;
            showModal('WebRTCæµ‹è¯•', content);
            
            const log = document.getElementById('webrtcLog');
            const progress = document.getElementById('webrtcProgress');
            
            const steps = [
                { msg: 'æ£€æŸ¥WebRTC APIæ”¯æŒ...', progress: 20 },
                { msg: 'æµ‹è¯•åª’ä½“è®¾å¤‡è®¿é—®...', progress: 40 },
                { msg: 'å»ºç«‹P2Pè¿æ¥...', progress: 60 },
                { msg: 'æµ‹è¯•æ•°æ®ä¼ è¾“...', progress: 80 },
                { msg: 'WebRTCæµ‹è¯•å®Œæˆï¼', progress: 100 }
            ];
            
            for (const step of steps) {
                await new Promise(resolve => setTimeout(resolve, 800));
                log.innerHTML += `\n${step.msg}`;
                progress.style.width = `${step.progress}%`;
                log.scrollTop = log.scrollHeight;
            }
        }

        async function runNetworkDiagnostics() {
            const content = `
                <p>æ­£åœ¨è¿è¡Œç½‘ç»œè¯Šæ–­...</p>
                <div class="progress-bar">
                    <div class="progress-fill" id="networkProgress"></div>
                </div>
                <div class="log-container" id="networkLog">å¼€å§‹ç½‘ç»œè¯Šæ–­...</div>
            `;
            showModal('ç½‘ç»œè¯Šæ–­', content);
            
            const log = document.getElementById('networkLog');
            const progress = document.getElementById('networkProgress');
            
            const steps = [
                { msg: 'æ£€æŸ¥ç½‘ç»œè¿æ¥çŠ¶æ€...', progress: 15 },
                { msg: 'æµ‹è¯•DNSè§£æ...', progress: 30 },
                { msg: 'æ£€æŸ¥é˜²ç«å¢™è®¾ç½®...', progress: 45 },
                { msg: 'æµ‹è¯•ç«¯å£è¿é€šæ€§...', progress: 60 },
                { msg: 'åˆ†æç½‘ç»œå»¶è¿Ÿ...', progress: 75 },
                { msg: 'æµ‹è¯•å¸¦å®½æ€§èƒ½...', progress: 90 },
                { msg: 'ç½‘ç»œè¯Šæ–­å®Œæˆï¼', progress: 100 }
            ];
            
            for (const step of steps) {
                await new Promise(resolve => setTimeout(resolve, 600));
                log.innerHTML += `\n${step.msg}`;
                progress.style.width = `${step.progress}%`;
                log.scrollTop = log.scrollHeight;
            }
        }

        function generateReport() {
            const content = `
                <p>æ­£åœ¨ç”Ÿæˆç»¼åˆæµ‹è¯•æŠ¥å‘Š...</p>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 100%;"></div>
                </div>
                <p style="margin-top: 15px;">æŠ¥å‘Šå°†åŒ…å«ï¼š</p>
                <ul style="margin: 10px 0; padding-left: 20px;">
                    <li>ç³»ç»ŸçŠ¶æ€æ€»è§ˆ</li>
                    <li>æ€§èƒ½æµ‹è¯•ç»“æœ</li>
                    <li>ä»£ç è´¨é‡åˆ†æ</li>
                    <li>ç½‘ç»œè¯Šæ–­æŠ¥å‘Š</li>
                    <li>ä¼˜åŒ–å»ºè®®</li>
                </ul>
                <button class="btn" style="margin-top: 15px;" onclick="downloadReport()">ä¸‹è½½æŠ¥å‘Š</button>
            `;
            showModal('ç”Ÿæˆç»¼åˆæŠ¥å‘Š', content);
        }

        function downloadReport() {
            const report = {
                timestamp: new Date().toISOString(),
                summary: 'Tesla LibreTV ç»¼åˆæµ‹è¯•æŠ¥å‘Š',
                systemStatus: {
                    proxy: 'online',
                    webrtc: 'supported',
                    network: 'connected',
                    browser: 'compatible'
                },
                recommendations: [
                    'å»ºè®®åœ¨ç‰¹æ–¯æ‹‰è½¦æœºä¸Šè¿›è¡Œå®é™…æµ‹è¯•',
                    'ä¼˜åŒ–WebRTCè¿æ¥ç¨³å®šæ€§',
                    'å¢å¼ºä»£ç†æœåŠ¡å™¨æ€§èƒ½ç›‘æ§'
                ]
            };
            
            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `tesla-libretv-report-${new Date().toISOString().slice(0, 10)}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            closeModal();
        }

        function exportConfig() {
            const config = {
                testSuite: 'Tesla LibreTV',
                version: '1.0.0',
                settings: {
                    proxyServer: 'http://localhost:3001',
                    testEnvironment: 'development',
                    autoTest: true,
                    benchmarkEnabled: true
                }
            };
            
            const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'tesla-libretv-config.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        function clearCache() {
            if (confirm('ç¡®å®šè¦æ¸…ç†æ‰€æœ‰ç¼“å­˜æ•°æ®å—ï¼Ÿ')) {
                localStorage.clear();
                sessionStorage.clear();
                if ('caches' in window) {
                    caches.keys().then(names => {
                        names.forEach(name => caches.delete(name));
                    });
                }
                alert('ç¼“å­˜å·²æ¸…ç†å®Œæˆï¼');
            }
        }

        function showHelp() {
            const content = `
                <h4>ğŸš— Tesla LibreTV æµ‹è¯•å¥—ä»¶ä½¿ç”¨æŒ‡å—</h4>
                <div style="text-align: left; line-height: 1.6;">
                    <h5>ğŸ“‹ æµ‹è¯•æµç¨‹å»ºè®®ï¼š</h5>
                    <ol>
                        <li><strong>ç³»ç»Ÿæ£€æŸ¥</strong>ï¼šé¦–å…ˆç¡®ä¿æ‰€æœ‰ç³»ç»ŸçŠ¶æ€ä¸ºç»¿è‰²</li>
                        <li><strong>ä»£ç è´¨é‡</strong>ï¼šè¿è¡Œä»£ç è´¨é‡æ£€æŸ¥ï¼Œä¿®å¤å‘ç°çš„é—®é¢˜</li>
                        <li><strong>æ€§èƒ½åŸºå‡†</strong>ï¼šæ‰§è¡Œæ€§èƒ½åŸºå‡†æµ‹è¯•ï¼Œä¼˜åŒ–å…³é”®æŒ‡æ ‡</li>
                        <li><strong>è‡ªåŠ¨åŒ–æµ‹è¯•</strong>ï¼šè¿è¡Œå®Œæ•´çš„è‡ªåŠ¨åŒ–æµ‹è¯•å¥—ä»¶</li>
                        <li><strong>ç½‘ç»œè¯Šæ–­</strong>ï¼šç¡®ä¿ç½‘ç»œé…ç½®æ­£ç¡®</li>
                        <li><strong>ç”ŸæˆæŠ¥å‘Š</strong>ï¼šå¯¼å‡ºç»¼åˆæµ‹è¯•æŠ¥å‘Š</li>
                    </ol>
                    
                    <h5>ğŸ”§ å¸¸è§é—®é¢˜ï¼š</h5>
                    <ul>
                        <li><strong>ä»£ç†æœåŠ¡å™¨ç¦»çº¿</strong>ï¼šæ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦å¯åŠ¨</li>
                        <li><strong>WebRTCä¸æ”¯æŒ</strong>ï¼šæ›´æ–°æµè§ˆå™¨æˆ–ä½¿ç”¨Chrome</li>
                        <li><strong>ç½‘ç»œè¿æ¥é—®é¢˜</strong>ï¼šæ£€æŸ¥é˜²ç«å¢™å’Œç½‘ç»œè®¾ç½®</li>
                    </ul>
                    
                    <h5>ğŸ“ æŠ€æœ¯æ”¯æŒï¼š</h5>
                    <p>å¦‚éœ€å¸®åŠ©ï¼Œè¯·æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£æˆ–è”ç³»å¼€å‘å›¢é˜Ÿã€‚</p>
                </div>
            `;
            showModal('å¸®åŠ©æ–‡æ¡£', content);
        }

        // åˆå§‹åŒ–æµ‹è¯•å¥—ä»¶
        document.addEventListener('DOMContentLoaded', () => {
            window.testSuite = new TeslaTestSuite();
        });

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.onclick = function(event) {
            const modal = document.getElementById('modal');
            if (event.target === modal) {
                closeModal();
            }
        }
    </script>
</body>
</html>