<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tesla LibreTV 综合测试套件</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .test-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .test-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
        }

        .test-card h3 {
            color: #2d3748;
            font-size: 1.4rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .test-card .icon {
            font-size: 1.5rem;
        }

        .test-card p {
            color: #718096;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .test-features {
            list-style: none;
            margin-bottom: 20px;
        }

        .test-features li {
            color: #4a5568;
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }

        .test-features li:before {
            content: '✓';
            position: absolute;
            left: 0;
            color: #48bb78;
            font-weight: bold;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn.secondary {
            background: #e2e8f0;
            color: #4a5568;
            margin-top: 10px;
        }

        .btn.secondary:hover {
            background: #cbd5e0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .status-panel {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .status-item {
            text-align: center;
            padding: 20px;
            background: #f7fafc;
            border-radius: 8px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .status-item.online {
            border-color: #48bb78;
            background: #f0fff4;
        }

        .status-item.offline {
            border-color: #f56565;
            background: #fffafa;
        }

        .status-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .status-label {
            color: #718096;
            font-size: 0.9rem;
        }

        .quick-actions {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .quick-actions h3 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }

        .action-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .action-btn {
            padding: 15px;
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 0.9rem;
            color: #4a5568;
        }

        .action-btn:hover {
            border-color: #667eea;
            background: #edf2f7;
            color: #667eea;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal h3 {
            color: #2d3748;
            margin-bottom: 20px;
        }

        .close {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #a0aec0;
        }

        .close:hover {
            color: #2d3748;
        }

        .log-container {
            background: #1a202c;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #48bb78, #38a169);
            width: 0%;
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            .test-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .container {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚗 Tesla LibreTV 综合测试套件</h1>
            <p>在PC端完成全面的测试、优化和质量检查工作</p>
        </div>

        <!-- 系统状态面板 -->
        <div class="status-panel">
            <h3>🔍 系统状态监控</h3>
            <div class="status-grid">
                <div class="status-item" id="proxyStatus">
                    <div class="status-value">检测中...</div>
                    <div class="status-label">代理服务器</div>
                </div>
                <div class="status-item" id="webrtcStatus">
                    <div class="status-value">检测中...</div>
                    <div class="status-label">WebRTC支持</div>
                </div>
                <div class="status-item" id="networkStatus">
                    <div class="status-value">检测中...</div>
                    <div class="status-label">网络连接</div>
                </div>
                <div class="status-item" id="browserStatus">
                    <div class="status-value">检测中...</div>
                    <div class="status-label">浏览器兼容性</div>
                </div>
            </div>
        </div>

        <!-- 测试工具网格 -->
        <div class="test-grid">
            <!-- 自动化测试 -->
            <div class="test-card">
                <h3><span class="icon">🤖</span>自动化测试</h3>
                <p>模拟特斯拉车机环境，自动测试各种视频播放方案的兼容性和性能表现。</p>
                <ul class="test-features">
                    <li>模拟多种特斯拉车型环境</li>
                    <li>自动测试WebRTC和代理方案</li>
                    <li>智能降级和故障恢复测试</li>
                    <li>生成详细测试报告</li>
                </ul>
                <button class="btn" onclick="openTestTool('tesla-test-runner.html')">启动自动化测试</button>
                <button class="btn secondary" onclick="showTestConfig()">配置测试参数</button>
            </div>

            <!-- 性能基准测试 -->
            <div class="test-card">
                <h3><span class="icon">⚡</span>性能基准测试</h3>
                <p>对比不同播放方案的性能指标，找出最优的播放策略和配置。</p>
                <ul class="test-features">
                    <li>加载时间和首帧时间测试</li>
                    <li>内存和CPU使用率监控</li>
                    <li>网络带宽和缓冲分析</li>
                    <li>播放质量评估</li>
                </ul>
                <button class="btn" onclick="openTestTool('performance-benchmark-dashboard.html')">启动性能测试</button>
                <button class="btn secondary" onclick="showBenchmarkConfig()">配置基准参数</button>
            </div>

            <!-- 代码质量检查 -->
            <div class="test-card">
                <h3><span class="icon">🔍</span>代码质量检查</h3>
                <p>分析代码质量、安全性和Tesla兼容性，提供优化建议和最佳实践。</p>
                <ul class="test-features">
                    <li>代码质量和复杂度分析</li>
                    <li>安全漏洞检测</li>
                    <li>Tesla兼容性检查</li>
                    <li>性能优化建议</li>
                </ul>
                <button class="btn" onclick="openTestTool('code-quality-dashboard.html')">启动质量检查</button>
                <button class="btn secondary" onclick="showQualityConfig()">配置检查规则</button>
            </div>

            <!-- 网络诊断工具 -->
            <div class="test-card">
                <h3><span class="icon">🌐</span>网络诊断工具</h3>
                <p>诊断网络连接问题，测试代理服务器性能，优化网络配置。</p>
                <ul class="test-features">
                    <li>代理服务器连通性测试</li>
                    <li>网络延迟和带宽测试</li>
                    <li>DNS解析和路由分析</li>
                    <li>防火墙和端口检测</li>
                </ul>
                <button class="btn" onclick="runNetworkDiagnostics()">启动网络诊断</button>
                <button class="btn secondary" onclick="showNetworkConfig()">配置网络参数</button>
            </div>
        </div>

        <!-- 快速操作面板 -->
        <div class="quick-actions">
            <h3>⚡ 快速操作</h3>
            <div class="action-grid">
                <div class="action-btn" onclick="checkProxyServer()">
                    <div>🔗</div>
                    <div>检查代理服务器</div>
                </div>
                <div class="action-btn" onclick="testWebRTC()">
                    <div>📹</div>
                    <div>测试WebRTC</div>
                </div>
                <div class="action-btn" onclick="generateReport()">
                    <div>📊</div>
                    <div>生成综合报告</div>
                </div>
                <div class="action-btn" onclick="exportConfig()">
                    <div>⚙️</div>
                    <div>导出配置</div>
                </div>
                <div class="action-btn" onclick="clearCache()">
                    <div>🗑️</div>
                    <div>清理缓存</div>
                </div>
                <div class="action-btn" onclick="showHelp()">
                    <div>❓</div>
                    <div>帮助文档</div>
                </div>
            </div>
        </div>
    </div>

    <!-- 模态框 -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h3 id="modalTitle">标题</h3>
            <div id="modalBody">内容</div>
        </div>
    </div>

    <script>
        class TeslaTestSuite {
            constructor() {
                this.init();
            }

            async init() {
                await this.checkSystemStatus();
                this.setupEventListeners();
                this.log('Tesla LibreTV 测试套件已初始化');
            }

            async checkSystemStatus() {
                // 检查代理服务器
                try {
                    const proxyResponse = await fetch('http://localhost:3001/api/health');
                    this.updateStatus('proxyStatus', proxyResponse.ok ? '在线' : '离线', proxyResponse.ok);
                } catch (error) {
                    this.updateStatus('proxyStatus', '离线', false);
                }

                // 检查WebRTC支持
                const webrtcSupported = !!(window.RTCPeerConnection || window.webkitRTCPeerConnection || window.mozRTCPeerConnection);
                this.updateStatus('webrtcStatus', webrtcSupported ? '支持' : '不支持', webrtcSupported);

                // 检查网络连接
                const networkOnline = navigator.onLine;
                this.updateStatus('networkStatus', networkOnline ? '已连接' : '离线', networkOnline);

                // 检查浏览器兼容性
                const browserCompatible = this.checkBrowserCompatibility();
                this.updateStatus('browserStatus', browserCompatible ? '兼容' : '不兼容', browserCompatible);
            }

            updateStatus(elementId, value, isOnline) {
                const element = document.getElementById(elementId);
                element.querySelector('.status-value').textContent = value;
                element.className = `status-item ${isOnline ? 'online' : 'offline'}`;
            }

            checkBrowserCompatibility() {
                // 检查关键API支持
                return !!(window.fetch && window.Promise && window.WebSocket && window.MediaSource);
            }

            setupEventListeners() {
                // 监听网络状态变化
                window.addEventListener('online', () => {
                    this.updateStatus('networkStatus', '已连接', true);
                    this.log('网络连接已恢复');
                });

                window.addEventListener('offline', () => {
                    this.updateStatus('networkStatus', '离线', false);
                    this.log('网络连接已断开', 'warning');
                });
            }

            log(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                console.log(`[${timestamp}] ${message}`);
            }
        }

        // 工具函数
        function openTestTool(url) {
            window.open(url, '_blank', 'width=1200,height=800');
        }

        function showModal(title, content) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalBody').innerHTML = content;
            document.getElementById('modal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        function showTestConfig() {
            const content = `
                <p>配置自动化测试参数：</p>
                <div style="margin: 15px 0;">
                    <label>测试环境：</label>
                    <select style="width: 100%; padding: 8px; margin-top: 5px;">
                        <option>Tesla Model S</option>
                        <option>Tesla Model 3</option>
                        <option>Tesla Model Y</option>
                        <option>Tesla Cybertruck</option>
                    </select>
                </div>
                <div style="margin: 15px 0;">
                    <label>测试场景：</label>
                    <select style="width: 100%; padding: 8px; margin-top: 5px;">
                        <option>基础兼容性测试</option>
                        <option>高级功能测试</option>
                        <option>性能压力测试</option>
                        <option>网络弹性测试</option>
                        <option>完整测试套件</option>
                    </select>
                </div>
                <button class="btn" style="margin-top: 15px;" onclick="closeModal()">保存配置</button>
            `;
            showModal('自动化测试配置', content);
        }

        function showBenchmarkConfig() {
            const content = `
                <p>配置性能基准测试参数：</p>
                <div style="margin: 15px 0;">
                    <label>测试次数：</label>
                    <input type="number" value="3" min="1" max="10" style="width: 100%; padding: 8px; margin-top: 5px;">
                </div>
                <div style="margin: 15px 0;">
                    <label>超时时间（秒）：</label>
                    <input type="number" value="30" min="10" max="120" style="width: 100%; padding: 8px; margin-top: 5px;">
                </div>
                <div style="margin: 15px 0;">
                    <label>测试视频：</label>
                    <select style="width: 100%; padding: 8px; margin-top: 5px;">
                        <option>短片测试（30秒）</option>
                        <option>中等长度（5分钟）</option>
                        <option>长片测试（30分钟）</option>
                        <option>高质量视频</option>
                    </select>
                </div>
                <button class="btn" style="margin-top: 15px;" onclick="closeModal()">保存配置</button>
            `;
            showModal('性能基准测试配置', content);
        }

        function showQualityConfig() {
            const content = `
                <p>配置代码质量检查规则：</p>
                <div style="margin: 15px 0;">
                    <label><input type="checkbox" checked> 性能优化检查</label><br>
                    <label><input type="checkbox" checked> 安全漏洞扫描</label><br>
                    <label><input type="checkbox" checked> Tesla兼容性检查</label><br>
                    <label><input type="checkbox" checked> 代码复杂度分析</label><br>
                    <label><input type="checkbox"> 严格模式检查</label>
                </div>
                <div style="margin: 15px 0;">
                    <label>检查深度：</label>
                    <select style="width: 100%; padding: 8px; margin-top: 5px;">
                        <option>快速检查</option>
                        <option selected>标准检查</option>
                        <option>深度检查</option>
                    </select>
                </div>
                <button class="btn" style="margin-top: 15px;" onclick="closeModal()">保存配置</button>
            `;
            showModal('代码质量检查配置', content);
        }

        function showNetworkConfig() {
            const content = `
                <p>配置网络诊断参数：</p>
                <div style="margin: 15px 0;">
                    <label>代理服务器地址：</label>
                    <input type="text" value="http://localhost:3001" style="width: 100%; padding: 8px; margin-top: 5px;">
                </div>
                <div style="margin: 15px 0;">
                    <label>测试超时（秒）：</label>
                    <input type="number" value="10" min="5" max="60" style="width: 100%; padding: 8px; margin-top: 5px;">
                </div>
                <div style="margin: 15px 0;">
                    <label>并发连接数：</label>
                    <input type="number" value="5" min="1" max="20" style="width: 100%; padding: 8px; margin-top: 5px;">
                </div>
                <button class="btn" style="margin-top: 15px;" onclick="closeModal()">保存配置</button>
            `;
            showModal('网络诊断配置', content);
        }

        async function checkProxyServer() {
            const content = `
                <p>正在检查代理服务器状态...</p>
                <div class="progress-bar">
                    <div class="progress-fill" id="proxyProgress"></div>
                </div>
                <div class="log-container" id="proxyLog">开始检查代理服务器...</div>
            `;
            showModal('代理服务器检查', content);
            
            // 模拟检查过程
            const log = document.getElementById('proxyLog');
            const progress = document.getElementById('proxyProgress');
            
            const steps = [
                { msg: '检查服务器连通性...', progress: 25 },
                { msg: '测试API端点...', progress: 50 },
                { msg: '验证代理功能...', progress: 75 },
                { msg: '检查完成！', progress: 100 }
            ];
            
            for (const step of steps) {
                await new Promise(resolve => setTimeout(resolve, 1000));
                log.innerHTML += `\n${step.msg}`;
                progress.style.width = `${step.progress}%`;
                log.scrollTop = log.scrollHeight;
            }
        }

        async function testWebRTC() {
            const content = `
                <p>正在测试WebRTC功能...</p>
                <div class="progress-bar">
                    <div class="progress-fill" id="webrtcProgress"></div>
                </div>
                <div class="log-container" id="webrtcLog">开始WebRTC测试...</div>
            `;
            showModal('WebRTC测试', content);
            
            const log = document.getElementById('webrtcLog');
            const progress = document.getElementById('webrtcProgress');
            
            const steps = [
                { msg: '检查WebRTC API支持...', progress: 20 },
                { msg: '测试媒体设备访问...', progress: 40 },
                { msg: '建立P2P连接...', progress: 60 },
                { msg: '测试数据传输...', progress: 80 },
                { msg: 'WebRTC测试完成！', progress: 100 }
            ];
            
            for (const step of steps) {
                await new Promise(resolve => setTimeout(resolve, 800));
                log.innerHTML += `\n${step.msg}`;
                progress.style.width = `${step.progress}%`;
                log.scrollTop = log.scrollHeight;
            }
        }

        async function runNetworkDiagnostics() {
            const content = `
                <p>正在运行网络诊断...</p>
                <div class="progress-bar">
                    <div class="progress-fill" id="networkProgress"></div>
                </div>
                <div class="log-container" id="networkLog">开始网络诊断...</div>
            `;
            showModal('网络诊断', content);
            
            const log = document.getElementById('networkLog');
            const progress = document.getElementById('networkProgress');
            
            const steps = [
                { msg: '检查网络连接状态...', progress: 15 },
                { msg: '测试DNS解析...', progress: 30 },
                { msg: '检查防火墙设置...', progress: 45 },
                { msg: '测试端口连通性...', progress: 60 },
                { msg: '分析网络延迟...', progress: 75 },
                { msg: '测试带宽性能...', progress: 90 },
                { msg: '网络诊断完成！', progress: 100 }
            ];
            
            for (const step of steps) {
                await new Promise(resolve => setTimeout(resolve, 600));
                log.innerHTML += `\n${step.msg}`;
                progress.style.width = `${step.progress}%`;
                log.scrollTop = log.scrollHeight;
            }
        }

        function generateReport() {
            const content = `
                <p>正在生成综合测试报告...</p>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 100%;"></div>
                </div>
                <p style="margin-top: 15px;">报告将包含：</p>
                <ul style="margin: 10px 0; padding-left: 20px;">
                    <li>系统状态总览</li>
                    <li>性能测试结果</li>
                    <li>代码质量分析</li>
                    <li>网络诊断报告</li>
                    <li>优化建议</li>
                </ul>
                <button class="btn" style="margin-top: 15px;" onclick="downloadReport()">下载报告</button>
            `;
            showModal('生成综合报告', content);
        }

        function downloadReport() {
            const report = {
                timestamp: new Date().toISOString(),
                summary: 'Tesla LibreTV 综合测试报告',
                systemStatus: {
                    proxy: 'online',
                    webrtc: 'supported',
                    network: 'connected',
                    browser: 'compatible'
                },
                recommendations: [
                    '建议在特斯拉车机上进行实际测试',
                    '优化WebRTC连接稳定性',
                    '增强代理服务器性能监控'
                ]
            };
            
            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `tesla-libretv-report-${new Date().toISOString().slice(0, 10)}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            closeModal();
        }

        function exportConfig() {
            const config = {
                testSuite: 'Tesla LibreTV',
                version: '1.0.0',
                settings: {
                    proxyServer: 'http://localhost:3001',
                    testEnvironment: 'development',
                    autoTest: true,
                    benchmarkEnabled: true
                }
            };
            
            const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'tesla-libretv-config.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        function clearCache() {
            if (confirm('确定要清理所有缓存数据吗？')) {
                localStorage.clear();
                sessionStorage.clear();
                if ('caches' in window) {
                    caches.keys().then(names => {
                        names.forEach(name => caches.delete(name));
                    });
                }
                alert('缓存已清理完成！');
            }
        }

        function showHelp() {
            const content = `
                <h4>🚗 Tesla LibreTV 测试套件使用指南</h4>
                <div style="text-align: left; line-height: 1.6;">
                    <h5>📋 测试流程建议：</h5>
                    <ol>
                        <li><strong>系统检查</strong>：首先确保所有系统状态为绿色</li>
                        <li><strong>代码质量</strong>：运行代码质量检查，修复发现的问题</li>
                        <li><strong>性能基准</strong>：执行性能基准测试，优化关键指标</li>
                        <li><strong>自动化测试</strong>：运行完整的自动化测试套件</li>
                        <li><strong>网络诊断</strong>：确保网络配置正确</li>
                        <li><strong>生成报告</strong>：导出综合测试报告</li>
                    </ol>
                    
                    <h5>🔧 常见问题：</h5>
                    <ul>
                        <li><strong>代理服务器离线</strong>：检查服务器是否启动</li>
                        <li><strong>WebRTC不支持</strong>：更新浏览器或使用Chrome</li>
                        <li><strong>网络连接问题</strong>：检查防火墙和网络设置</li>
                    </ul>
                    
                    <h5>📞 技术支持：</h5>
                    <p>如需帮助，请查看项目文档或联系开发团队。</p>
                </div>
            `;
            showModal('帮助文档', content);
        }

        // 初始化测试套件
        document.addEventListener('DOMContentLoaded', () => {
            window.testSuite = new TeslaTestSuite();
        });

        // 点击模态框外部关闭
        window.onclick = function(event) {
            const modal = document.getElementById('modal');
            if (event.target === modal) {
                closeModal();
            }
        }
    </script>
</body>
</html>