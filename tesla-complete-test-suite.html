<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teslaå®Œæ•´æµ‹è¯•å¥—ä»¶ - LibreTV</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .test-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .test-panel:hover {
            transform: translateY(-5px);
        }
        
        .panel-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .panel-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 1.5em;
            color: white;
        }
        
        .webrtc-icon { background: #4CAF50; }
        .proxy-icon { background: #2196F3; }
        .performance-icon { background: #FF9800; }
        .fallback-icon { background: #9C27B0; }
        
        .panel-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #333;
        }
        
        .control-group {
            margin-bottom: 20px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }
        
        .control-group input,
        .control-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        
        .control-group input:focus,
        .control-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #4CAF50;
            color: white;
        }
        
        .btn-success:hover {
            background: #45a049;
        }
        
        .btn-warning {
            background: #FF9800;
            color: white;
        }
        
        .btn-warning:hover {
            background: #f57c00;
        }
        
        .btn-danger {
            background: #f44336;
            color: white;
        }
        
        .btn-danger:hover {
            background: #da190b;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-success { background: #4CAF50; }
        .status-warning { background: #FF9800; }
        .status-error { background: #f44336; }
        .status-info { background: #2196F3; }
        
        .video-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .video-wrapper {
            position: relative;
            width: 100%;
            height: 400px;
            background: #000;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        #testVideo {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2em;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .video-overlay.show {
            opacity: 1;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .metric-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .metric-value {
            font-size: 1.8em;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .metric-label {
            font-size: 0.9em;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .log-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .log-content {
            background: #1e1e1e;
            color: #f0f0f0;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.4;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 5px;
            border-radius: 3px;
        }
        
        .log-info { background: rgba(33, 150, 243, 0.1); }
        .log-success { background: rgba(76, 175, 80, 0.1); }
        .log-warning { background: rgba(255, 152, 0, 0.1); }
        .log-error { background: rgba(244, 67, 54, 0.1); }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
            width: 0%;
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid;
        }
        
        .alert-info {
            background: #e3f2fd;
            border-color: #2196F3;
            color: #1976d2;
        }
        
        .alert-success {
            background: #e8f5e8;
            border-color: #4CAF50;
            color: #2e7d32;
        }
        
        .alert-warning {
            background: #fff3e0;
            border-color: #FF9800;
            color: #f57c00;
        }
        
        .alert-error {
            background: #ffebee;
            border-color: #f44336;
            color: #c62828;
        }
        
        @media (max-width: 768px) {
            .test-grid {
                grid-template-columns: 1fr;
            }
            
            .metrics-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš— Teslaå®Œæ•´æµ‹è¯•å¥—ä»¶</h1>
            <p>WebRTC + ä»£ç†æœåŠ¡å™¨ + æ€§èƒ½ç›‘æ§ + æ™ºèƒ½é™çº§</p>
        </div>
        
        <!-- æµ‹è¯•æ§åˆ¶é¢æ¿ -->
        <div class="test-grid">
            <!-- WebRTCæµ‹è¯•é¢æ¿ -->
            <div class="test-panel">
                <div class="panel-header">
                    <div class="panel-icon webrtc-icon">ğŸ¥</div>
                    <div class="panel-title">WebRTCå®æ—¶æµåª’ä½“</div>
                </div>
                
                <div class="control-group">
                    <label>ä¿¡ä»¤æœåŠ¡å™¨åœ°å€:</label>
                    <input type="text" id="signalServerUrl" value="ws://localhost:8080/signal" placeholder="ws://localhost:8080/signal">
                </div>
                
                <div class="control-group">
                    <label>è§†é¢‘æºURL:</label>
                    <input type="text" id="webrtcVideoUrl" value="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4" placeholder="è§†é¢‘URL">
                </div>
                
                <button class="btn btn-primary" onclick="testWebRTC()">ğŸš€ æµ‹è¯•WebRTC</button>
                <button class="btn btn-warning" onclick="stopWebRTC()">â¹ï¸ åœæ­¢</button>
                
                <div id="webrtcStatus" class="alert alert-info" style="margin-top: 15px;">
                    <span class="status-indicator status-info"></span>
                    WebRTCå°±ç»ªï¼Œç­‰å¾…æµ‹è¯•
                </div>
            </div>
            
            <!-- ä»£ç†æœåŠ¡å™¨æµ‹è¯•é¢æ¿ -->
            <div class="test-panel">
                <div class="panel-header">
                    <div class="panel-icon proxy-icon">ğŸ”„</div>
                    <div class="panel-title">ä»£ç†æœåŠ¡å™¨æ’­æ”¾</div>
                </div>
                
                <div class="control-group">
                    <label>ä»£ç†æœåŠ¡å™¨åœ°å€:</label>
                    <input type="text" id="proxyServerUrl" value="http://localhost:3001" placeholder="http://localhost:3001">
                </div>
                
                <div class="control-group">
                    <label>è§†é¢‘æºURL:</label>
                    <input type="text" id="proxyVideoUrl" value="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4" placeholder="è§†é¢‘URL">
                </div>
                
                <div class="control-group">
                    <label>æ’­æ”¾æ¨¡å¼:</label>
                    <select id="proxyMode">
                        <option value="proxy">ä»£ç†æ¨¡å¼</option>
                        <option value="transcode">è½¬ç æ¨¡å¼</option>
                        <option value="stream">æµåª’ä½“æ¨¡å¼</option>
                    </select>
                </div>
                
                <button class="btn btn-primary" onclick="testProxy()">ğŸš€ æµ‹è¯•ä»£ç†</button>
                <button class="btn btn-warning" onclick="stopProxy()">â¹ï¸ åœæ­¢</button>
                
                <div id="proxyStatus" class="alert alert-info" style="margin-top: 15px;">
                    <span class="status-indicator status-info"></span>
                    ä»£ç†æœåŠ¡å™¨å°±ç»ªï¼Œç­‰å¾…æµ‹è¯•
                </div>
            </div>
            
            <!-- æ€§èƒ½ç›‘æ§é¢æ¿ -->
            <div class="test-panel">
                <div class="panel-header">
                    <div class="panel-icon performance-icon">ğŸ“Š</div>
                    <div class="panel-title">æ€§èƒ½ç›‘æ§</div>
                </div>
                
                <div class="control-group">
                    <label>ç›‘æ§é—´éš” (æ¯«ç§’):</label>
                    <input type="number" id="monitorInterval" value="1000" min="500" max="5000">
                </div>
                
                <div class="control-group">
                    <label>ä¼˜åŒ–é—´éš” (æ¯«ç§’):</label>
                    <input type="number" id="optimizeInterval" value="10000" min="5000" max="30000">
                </div>
                
                <button class="btn btn-success" onclick="startMonitoring()">ğŸ“ˆ å¼€å§‹ç›‘æ§</button>
                <button class="btn btn-danger" onclick="stopMonitoring()">ğŸ“‰ åœæ­¢ç›‘æ§</button>
                <button class="btn btn-warning" onclick="resetMetrics()">ğŸ”„ é‡ç½®æŒ‡æ ‡</button>
                
                <div id="monitoringStatus" class="alert alert-info" style="margin-top: 15px;">
                    <span class="status-indicator status-info"></span>
                    æ€§èƒ½ç›‘æ§å°±ç»ª
                </div>
            </div>
            
            <!-- æ™ºèƒ½é™çº§é¢æ¿ -->
            <div class="test-panel">
                <div class="panel-header">
                    <div class="panel-icon fallback-icon">ğŸ§ </div>
                    <div class="panel-title">æ™ºèƒ½é™çº§æµ‹è¯•</div>
                </div>
                
                <div class="control-group">
                    <label>æµ‹è¯•è§†é¢‘URL:</label>
                    <input type="text" id="fallbackVideoUrl" value="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerBlazes.mp4" placeholder="è§†é¢‘URL">
                </div>
                
                <div class="control-group">
                    <label>é™çº§ç­–ç•¥:</label>
                    <select id="fallbackStrategy">
                        <option value="auto">è‡ªåŠ¨é€‰æ‹©</option>
                        <option value="quality_first">è´¨é‡ä¼˜å…ˆ</option>
                        <option value="speed_first">é€Ÿåº¦ä¼˜å…ˆ</option>
                        <option value="compatibility_first">å…¼å®¹æ€§ä¼˜å…ˆ</option>
                    </select>
                </div>
                
                <button class="btn btn-primary" onclick="testFallback()">ğŸ§  æ™ºèƒ½æ’­æ”¾</button>
                <button class="btn btn-warning" onclick="stopFallback()">â¹ï¸ åœæ­¢</button>
                
                <div id="fallbackStatus" class="alert alert-info" style="margin-top: 15px;">
                    <span class="status-indicator status-info"></span>
                    æ™ºèƒ½é™çº§å°±ç»ª
                </div>
            </div>
        </div>
        
        <!-- è§†é¢‘æ’­æ”¾åŒºåŸŸ -->
        <div class="video-container">
            <h3>ğŸ“º è§†é¢‘æ’­æ”¾åŒºåŸŸ</h3>
            <div class="video-wrapper">
                <video id="testVideo" controls>
                    æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚
                </video>
                <div id="videoOverlay" class="video-overlay">
                    <div>ç­‰å¾…æ’­æ”¾...</div>
                </div>
            </div>
            
            <div class="control-group">
                <button class="btn btn-success" onclick="playVideo()">â–¶ï¸ æ’­æ”¾</button>
                <button class="btn btn-warning" onclick="pauseVideo()">â¸ï¸ æš‚åœ</button>
                <button class="btn btn-danger" onclick="stopVideo()">â¹ï¸ åœæ­¢</button>
                <button class="btn btn-primary" onclick="toggleFullscreen()">ğŸ” å…¨å±</button>
            </div>
        </div>
        
        <!-- æ€§èƒ½æŒ‡æ ‡æ˜¾ç¤º -->
        <div class="video-container">
            <h3>ğŸ“Š å®æ—¶æ€§èƒ½æŒ‡æ ‡</h3>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value" id="bandwidthMetric">0</div>
                    <div class="metric-label">å¸¦å®½ (Mbps)</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="fpsMetric">0</div>
                    <div class="metric-label">å¸§ç‡ (FPS)</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="latencyMetric">0</div>
                    <div class="metric-label">å»¶è¿Ÿ (ms)</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="cpuMetric">0</div>
                    <div class="metric-label">CPU (%)</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="memoryMetric">0</div>
                    <div class="metric-label">å†…å­˜ (%)</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="scoreMetric">0</div>
                    <div class="metric-label">æ€»ä½“è¯„åˆ†</div>
                </div>
            </div>
            
            <div class="progress-bar">
                <div id="performanceProgress" class="progress-fill"></div>
            </div>
        </div>
        
        <!-- æ—¥å¿—æ˜¾ç¤ºåŒºåŸŸ -->
        <div class="log-container">
            <div class="log-header">
                <h3>ğŸ“‹ ç³»ç»Ÿæ—¥å¿—</h3>
                <div>
                    <button class="btn btn-warning" onclick="clearLogs()">ğŸ—‘ï¸ æ¸…ç©ºæ—¥å¿—</button>
                    <button class="btn btn-primary" onclick="exportLogs()">ğŸ’¾ å¯¼å‡ºæ—¥å¿—</button>
                </div>
            </div>
            <div id="logContent" class="log-content">
                <div class="log-entry log-info">[INFO] Teslaæµ‹è¯•å¥—ä»¶å·²åŠ è½½</div>
            </div>
        </div>
    </div>
    
    <!-- å¼•å…¥æ‰€æœ‰å¿…è¦çš„è„šæœ¬ -->
    <script src="js/tesla-webrtc-player.js"></script>
    <script src="js/tesla-proxy-client.js"></script>
    <script src="js/tesla-performance-monitor.js"></script>
    <script src="js/tesla-fallback-manager.js"></script>
    
    <script>
        // å…¨å±€å˜é‡
        let webrtcPlayer = null;
        let proxyClient = null;
        let performanceMonitor = null;
        let fallbackManager = null;
        let currentMethod = null;
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeTestSuite();
        });
        
        /**
         * åˆå§‹åŒ–æµ‹è¯•å¥—ä»¶
         */
        function initializeTestSuite() {
            log('åˆå§‹åŒ–Teslaæµ‹è¯•å¥—ä»¶...', 'info');
            
            // åˆå§‹åŒ–ä»£ç†å®¢æˆ·ç«¯
            proxyClient = new TeslaProxyClient({
                serverUrl: 'http://localhost:3001',
                debug: true
            });
            
            // åˆå§‹åŒ–æ€§èƒ½ç›‘æ§å™¨
            performanceMonitor = new TeslaPerformanceMonitor({
                debug: true,
                monitoringInterval: 1000,
                optimizationInterval: 10000,
                onMetricsUpdate: updateMetricsDisplay,
                onPerformanceAlert: handlePerformanceAlert,
                onOptimizationApplied: handleOptimizationApplied
            });
            
            // åˆå§‹åŒ–æ™ºèƒ½é™çº§ç®¡ç†å™¨
            fallbackManager = new TeslaFallbackManager({
                debug: true,
                onMethodSelected: handleMethodSelected,
                onMethodFailed: handleMethodFailed,
                onFallbackComplete: handleFallbackComplete
            });
            
            log('æµ‹è¯•å¥—ä»¶åˆå§‹åŒ–å®Œæˆ', 'success');
        }
        
        /**
         * æµ‹è¯•WebRTC
         */
        async function testWebRTC() {
            try {
                log('å¼€å§‹WebRTCæµ‹è¯•...', 'info');
                updateStatus('webrtcStatus', 'æ­£åœ¨è¿æ¥WebRTC...', 'warning');
                
                const signalServerUrl = document.getElementById('signalServerUrl').value;
                const videoUrl = document.getElementById('webrtcVideoUrl').value;
                
                // åˆ›å»ºWebRTCæ’­æ”¾å™¨
                webrtcPlayer = new TeslaWebRTCPlayer({
                    signalServerUrl: signalServerUrl,
                    debug: true
                });
                
                // è¿æ¥å¹¶æ’­æ”¾
                await webrtcPlayer.connect();
                await webrtcPlayer.play(videoUrl, document.getElementById('testVideo'));
                
                currentMethod = 'webrtc';
                updateStatus('webrtcStatus', 'WebRTCè¿æ¥æˆåŠŸï¼Œæ­£åœ¨æ’­æ”¾', 'success');
                hideVideoOverlay();
                
                log('WebRTCæµ‹è¯•æˆåŠŸ', 'success');
                
            } catch (error) {
                log(`WebRTCæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                updateStatus('webrtcStatus', `WebRTCè¿æ¥å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        /**
         * åœæ­¢WebRTC
         */
        function stopWebRTC() {
            if (webrtcPlayer) {
                webrtcPlayer.disconnect();
                webrtcPlayer = null;
                currentMethod = null;
                updateStatus('webrtcStatus', 'WebRTCå·²åœæ­¢', 'info');
                showVideoOverlay('WebRTCå·²åœæ­¢');
                log('WebRTCå·²åœæ­¢', 'info');
            }
        }
        
        /**
         * æµ‹è¯•ä»£ç†æœåŠ¡å™¨
         */
        async function testProxy() {
            try {
                log('å¼€å§‹ä»£ç†æœåŠ¡å™¨æµ‹è¯•...', 'info');
                updateStatus('proxyStatus', 'æ­£åœ¨è¿æ¥ä»£ç†æœåŠ¡å™¨...', 'warning');
                
                const serverUrl = document.getElementById('proxyServerUrl').value;
                const videoUrl = document.getElementById('proxyVideoUrl').value;
                const mode = document.getElementById('proxyMode').value;
                
                // æ›´æ–°ä»£ç†å®¢æˆ·ç«¯é…ç½®
                proxyClient.serverUrl = serverUrl;
                
                // æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
                const status = await proxyClient.checkServerStatus();
                if (!status.available) {
                    throw new Error('ä»£ç†æœåŠ¡å™¨ä¸å¯ç”¨');
                }
                
                // æ ¹æ®æ¨¡å¼ç”ŸæˆURL
                let proxyUrl;
                switch (mode) {
                    case 'transcode':
                        proxyUrl = proxyClient.getTranscodeUrl(videoUrl, 'tesla_optimized');
                        break;
                    case 'stream':
                        proxyUrl = proxyClient.getStreamUrl(videoUrl);
                        break;
                    default:
                        proxyUrl = proxyClient.getProxyUrl(videoUrl);
                }
                
                // æ’­æ”¾è§†é¢‘
                const video = document.getElementById('testVideo');
                video.src = proxyUrl;
                await video.play();
                
                currentMethod = 'proxy';
                updateStatus('proxyStatus', `ä»£ç†æœåŠ¡å™¨è¿æ¥æˆåŠŸ (${mode}æ¨¡å¼)`, 'success');
                hideVideoOverlay();
                
                log(`ä»£ç†æœåŠ¡å™¨æµ‹è¯•æˆåŠŸ (${mode}æ¨¡å¼)`, 'success');
                
            } catch (error) {
                log(`ä»£ç†æœåŠ¡å™¨æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                updateStatus('proxyStatus', `ä»£ç†æœåŠ¡å™¨è¿æ¥å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        /**
         * åœæ­¢ä»£ç†æ’­æ”¾
         */
        function stopProxy() {
            const video = document.getElementById('testVideo');
            video.pause();
            video.src = '';
            currentMethod = null;
            updateStatus('proxyStatus', 'ä»£ç†æ’­æ”¾å·²åœæ­¢', 'info');
            showVideoOverlay('ä»£ç†æ’­æ”¾å·²åœæ­¢');
            log('ä»£ç†æ’­æ”¾å·²åœæ­¢', 'info');
        }
        
        /**
         * å¼€å§‹æ€§èƒ½ç›‘æ§
         */
        function startMonitoring() {
            const video = document.getElementById('testVideo');
            const monitorInterval = parseInt(document.getElementById('monitorInterval').value);
            const optimizeInterval = parseInt(document.getElementById('optimizeInterval').value);
            
            performanceMonitor.monitoringInterval = monitorInterval;
            performanceMonitor.optimizationInterval = optimizeInterval;
            
            performanceMonitor.startMonitoring(video, getCurrentPlayer());
            
            updateStatus('monitoringStatus', 'æ€§èƒ½ç›‘æ§å·²å¯åŠ¨', 'success');
            log('æ€§èƒ½ç›‘æ§å·²å¯åŠ¨', 'success');
        }
        
        /**
         * åœæ­¢æ€§èƒ½ç›‘æ§
         */
        function stopMonitoring() {
            performanceMonitor.stopMonitoring();
            updateStatus('monitoringStatus', 'æ€§èƒ½ç›‘æ§å·²åœæ­¢', 'info');
            log('æ€§èƒ½ç›‘æ§å·²åœæ­¢', 'info');
        }
        
        /**
         * é‡ç½®æ€§èƒ½æŒ‡æ ‡
         */
        function resetMetrics() {
            performanceMonitor.resetMetrics();
            updateMetricsDisplay({
                bandwidth: { current: 0 },
                playback: { fps: 0, latency: 0 },
                system: { cpu: 0, memory: 0 },
                experience: { userSatisfaction: 0 }
            });
            log('æ€§èƒ½æŒ‡æ ‡å·²é‡ç½®', 'info');
        }
        
        /**
         * æµ‹è¯•æ™ºèƒ½é™çº§
         */
        async function testFallback() {
            try {
                log('å¼€å§‹æ™ºèƒ½é™çº§æµ‹è¯•...', 'info');
                updateStatus('fallbackStatus', 'æ­£åœ¨åˆ†ææœ€ä½³æ’­æ”¾æ–¹æ¡ˆ...', 'warning');
                
                const videoUrl = document.getElementById('fallbackVideoUrl').value;
                const strategy = document.getElementById('fallbackStrategy').value;
                
                // æ‰§è¡Œæ™ºèƒ½é™çº§æ’­æ”¾
                await fallbackManager.executeWithFallback(videoUrl, async (method, url, options) => {
                    log(`å°è¯•æ’­æ”¾æ–¹æ¡ˆ: ${method.name}`, 'info');
                    
                    switch (method.name) {
                        case 'webrtc':
                            return await playWithWebRTC(url);
                        case 'proxy':
                        case 'transcode':
                            return await playWithProxy(url, method.name);
                        case 'direct':
                            return await playDirect(url);
                        default:
                            throw new Error(`æœªçŸ¥çš„æ’­æ”¾æ–¹æ¡ˆ: ${method.name}`);
                    }
                }, { strategy });
                
                updateStatus('fallbackStatus', 'æ™ºèƒ½é™çº§æ’­æ”¾æˆåŠŸ', 'success');
                hideVideoOverlay();
                
            } catch (error) {
                log(`æ™ºèƒ½é™çº§æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                updateStatus('fallbackStatus', `æ™ºèƒ½é™çº§å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        /**
         * åœæ­¢æ™ºèƒ½é™çº§
         */
        function stopFallback() {
            stopVideo();
            updateStatus('fallbackStatus', 'æ™ºèƒ½é™çº§å·²åœæ­¢', 'info');
            log('æ™ºèƒ½é™çº§å·²åœæ­¢', 'info');
        }
        
        /**
         * ä½¿ç”¨WebRTCæ’­æ”¾
         */
        async function playWithWebRTC(url) {
            if (!webrtcPlayer) {
                webrtcPlayer = new TeslaWebRTCPlayer({
                    signalServerUrl: document.getElementById('signalServerUrl').value,
                    debug: true
                });
                await webrtcPlayer.connect();
            }
            
            await webrtcPlayer.play(url, document.getElementById('testVideo'));
            currentMethod = 'webrtc';
            return 'webrtc';
        }
        
        /**
         * ä½¿ç”¨ä»£ç†æ’­æ”¾
         */
        async function playWithProxy(url, mode) {
            let proxyUrl;
            
            switch (mode) {
                case 'transcode':
                    proxyUrl = proxyClient.getTranscodeUrl(url, 'tesla_optimized');
                    break;
                default:
                    proxyUrl = proxyClient.getProxyUrl(url);
            }
            
            const video = document.getElementById('testVideo');
            video.src = proxyUrl;
            await video.play();
            
            currentMethod = 'proxy';
            return 'proxy';
        }
        
        /**
         * ç›´æ¥æ’­æ”¾
         */
        async function playDirect(url) {
            const video = document.getElementById('testVideo');
            video.src = url;
            await video.play();
            
            currentMethod = 'direct';
            return 'direct';
        }
        
        /**
         * è·å–å½“å‰æ’­æ”¾å™¨
         */
        function getCurrentPlayer() {
            switch (currentMethod) {
                case 'webrtc':
                    return webrtcPlayer;
                case 'proxy':
                    return proxyClient;
                default:
                    return null;
            }
        }
        
        /**
         * è§†é¢‘æ§åˆ¶å‡½æ•°
         */
        function playVideo() {
            const video = document.getElementById('testVideo');
            video.play();
            log('è§†é¢‘æ’­æ”¾', 'info');
        }
        
        function pauseVideo() {
            const video = document.getElementById('testVideo');
            video.pause();
            log('è§†é¢‘æš‚åœ', 'info');
        }
        
        function stopVideo() {
            const video = document.getElementById('testVideo');
            video.pause();
            video.currentTime = 0;
            showVideoOverlay('è§†é¢‘å·²åœæ­¢');
            log('è§†é¢‘åœæ­¢', 'info');
        }
        
        function toggleFullscreen() {
            const video = document.getElementById('testVideo');
            if (video.requestFullscreen) {
                video.requestFullscreen();
            } else if (video.webkitRequestFullscreen) {
                video.webkitRequestFullscreen();
            } else if (video.msRequestFullscreen) {
                video.msRequestFullscreen();
            }
        }
        
        /**
         * æ›´æ–°çŠ¶æ€æ˜¾ç¤º
         */
        function updateStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            const indicator = element.querySelector('.status-indicator');
            
            element.className = `alert alert-${type}`;
            indicator.className = `status-indicator status-${type}`;
            
            // æ›´æ–°æ–‡æœ¬ï¼Œä¿ç•™çŠ¶æ€æŒ‡ç¤ºå™¨
            const textNode = element.childNodes[element.childNodes.length - 1];
            if (textNode.nodeType === Node.TEXT_NODE) {
                textNode.textContent = message;
            } else {
                element.appendChild(document.createTextNode(message));
            }
        }
        
        /**
         * æ˜¾ç¤º/éšè—è§†é¢‘è¦†ç›–å±‚
         */
        function showVideoOverlay(message) {
            const overlay = document.getElementById('videoOverlay');
            overlay.querySelector('div').textContent = message;
            overlay.classList.add('show');
        }
        
        function hideVideoOverlay() {
            const overlay = document.getElementById('videoOverlay');
            overlay.classList.remove('show');
        }
        
        /**
         * æ›´æ–°æ€§èƒ½æŒ‡æ ‡æ˜¾ç¤º
         */
        function updateMetricsDisplay(metrics) {
            document.getElementById('bandwidthMetric').textContent = 
                (metrics.bandwidth.current / 1000000).toFixed(1);
            document.getElementById('fpsMetric').textContent = 
                metrics.playback.fps.toFixed(0);
            document.getElementById('latencyMetric').textContent = 
                metrics.playback.latency.toFixed(0);
            document.getElementById('cpuMetric').textContent = 
                metrics.system.cpu.toFixed(0);
            document.getElementById('memoryMetric').textContent = 
                metrics.system.memory.toFixed(0);
            
            // è®¡ç®—æ€»ä½“è¯„åˆ†
            const score = performanceMonitor.calculateOverallScore();
            document.getElementById('scoreMetric').textContent = score;
            
            // æ›´æ–°è¿›åº¦æ¡
            const progressBar = document.getElementById('performanceProgress');
            progressBar.style.width = `${score}%`;
        }
        
        /**
         * å¤„ç†æ€§èƒ½è­¦å‘Š
         */
        function handlePerformanceAlert(alerts) {
            alerts.forEach(alert => {
                log(`æ€§èƒ½è­¦å‘Š: ${alert.message} (${alert.value}/${alert.threshold})`, 'warning');
            });
        }
        
        /**
         * å¤„ç†ä¼˜åŒ–åº”ç”¨
         */
        function handleOptimizationApplied(optimizations) {
            optimizations.forEach(opt => {
                log(`åº”ç”¨ä¼˜åŒ–: ${opt.type} (${opt.reason})`, 'success');
            });
        }
        
        /**
         * å¤„ç†æ–¹æ¡ˆé€‰æ‹©
         */
        function handleMethodSelected(method) {
            log(`é€‰æ‹©æ’­æ”¾æ–¹æ¡ˆ: ${method.name} - ${method.description}`, 'info');
        }
        
        /**
         * å¤„ç†æ–¹æ¡ˆå¤±è´¥
         */
        function handleMethodFailed(info) {
            log(`æ’­æ”¾æ–¹æ¡ˆå¤±è´¥: ${info.method.name} - ${info.error.message}`, 'warning');
        }
        
        /**
         * å¤„ç†é™çº§å®Œæˆ
         */
        function handleFallbackComplete(result) {
            if (result.success) {
                log(`é™çº§æˆåŠŸ: ä½¿ç”¨æ–¹æ¡ˆ ${result.method.name}`, 'success');
            } else {
                log(`é™çº§å¤±è´¥: ${result.error.message}`, 'error');
            }
        }
        
        /**
         * æ—¥å¿—å‡½æ•°
         */
        function log(message, type = 'info') {
            const logContent = document.getElementById('logContent');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            
            logEntry.className = `log-entry log-${type}`;
            logEntry.textContent = `[${timestamp}] [${type.toUpperCase()}] ${message}`;
            
            logContent.appendChild(logEntry);
            logContent.scrollTop = logContent.scrollHeight;
            
            // é™åˆ¶æ—¥å¿—æ¡æ•°
            const entries = logContent.querySelectorAll('.log-entry');
            if (entries.length > 100) {
                entries[0].remove();
            }
        }
        
        /**
         * æ¸…ç©ºæ—¥å¿—
         */
        function clearLogs() {
            const logContent = document.getElementById('logContent');
            logContent.innerHTML = '<div class="log-entry log-info">[INFO] æ—¥å¿—å·²æ¸…ç©º</div>';
        }
        
        /**
         * å¯¼å‡ºæ—¥å¿—
         */
        function exportLogs() {
            const logContent = document.getElementById('logContent');
            const logs = Array.from(logContent.querySelectorAll('.log-entry'))
                .map(entry => entry.textContent)
                .join('\n');
            
            const blob = new Blob([logs], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `tesla-test-logs-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.txt`;
            a.click();
            
            URL.revokeObjectURL(url);
            log('æ—¥å¿—å·²å¯¼å‡º', 'success');
        }
    </script>
</body>
</html>