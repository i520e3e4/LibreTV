<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TeslaÂÆåÊï¥ÊµãËØïÂ•ó‰ª∂ - LibreTV</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .test-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .test-panel:hover {
            transform: translateY(-5px);
        }
        
        .panel-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .panel-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 1.5em;
            color: white;
        }
        
        .webrtc-icon { background: #4CAF50; }
        .proxy-icon { background: #2196F3; }
        .performance-icon { background: #FF9800; }
        .fallback-icon { background: #9C27B0; }
        
        .panel-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #333;
        }
        
        .control-group {
            margin-bottom: 20px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }
        
        .control-group input,
        .control-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        
        .control-group input:focus,
        .control-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #4CAF50;
            color: white;
        }
        
        .btn-success:hover {
            background: #45a049;
        }
        
        .btn-warning {
            background: #FF9800;
            color: white;
        }
        
        .btn-warning:hover {
            background: #f57c00;
        }
        
        .btn-danger {
            background: #f44336;
            color: white;
        }
        
        .btn-danger:hover {
            background: #da190b;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-success { background: #4CAF50; }
        .status-warning { background: #FF9800; }
        .status-error { background: #f44336; }
        .status-info { background: #2196F3; }
        
        .video-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .video-wrapper {
            position: relative;
            width: 100%;
            height: 400px;
            background: #000;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        #testVideo {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2em;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .video-overlay.show {
            opacity: 1;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .metric-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .metric-value {
            font-size: 1.8em;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .metric-label {
            font-size: 0.9em;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .log-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .log-content {
            background: #1e1e1e;
            color: #f0f0f0;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.4;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 5px;
            border-radius: 3px;
        }
        
        .log-info { background: rgba(33, 150, 243, 0.1); }
        .log-success { background: rgba(76, 175, 80, 0.1); }
        .log-warning { background: rgba(255, 152, 0, 0.1); }
        .log-error { background: rgba(244, 67, 54, 0.1); }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
            width: 0%;
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid;
        }
        
        .alert-info {
            background: #e3f2fd;
            border-color: #2196F3;
            color: #1976d2;
        }
        
        .alert-success {
            background: #e8f5e8;
            border-color: #4CAF50;
            color: #2e7d32;
        }
        
        .alert-warning {
            background: #fff3e0;
            border-color: #FF9800;
            color: #f57c00;
        }
        
        .alert-error {
            background: #ffebee;
            border-color: #f44336;
            color: #c62828;
        }
        
        @media (max-width: 768px) {
            .test-grid {
                grid-template-columns: 1fr;
            }
            
            .metrics-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöó TeslaÂÆåÊï¥ÊµãËØïÂ•ó‰ª∂</h1>
            <p>WebRTC + ‰ª£ÁêÜÊúçÂä°Âô® + ÊÄßËÉΩÁõëÊéß + Êô∫ËÉΩÈôçÁ∫ß</p>
        </div>
        
        <!-- ÊµãËØïÊéßÂà∂Èù¢Êùø -->
        <div class="test-grid">
            <!-- WebRTCÊµãËØïÈù¢Êùø -->
            <div class="test-panel">
                <div class="panel-header">
                    <div class="panel-icon webrtc-icon">üé•</div>
                    <div class="panel-title">WebRTCÂÆûÊó∂ÊµÅÂ™í‰Ωì</div>
                </div>
                
                <div class="control-group">
                    <label>‰ø°‰ª§ÊúçÂä°Âô®Âú∞ÂùÄ:</label>
                    <input type="text" id="signalServerUrl" value="ws://localhost:8080/signal" placeholder="ws://localhost:8080/signal">
                </div>
                
                <div class="control-group">
                    <label>ËßÜÈ¢ëÊ∫êURL:</label>
                    <input type="text" id="webrtcVideoUrl" value="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4" placeholder="ËßÜÈ¢ëURL">
                </div>
                
                <button class="btn btn-primary" onclick="testWebRTC()">üöÄ ÊµãËØïWebRTC</button>
                <button class="btn btn-warning" onclick="stopWebRTC()">‚èπÔ∏è ÂÅúÊ≠¢</button>
                
                <div id="webrtcStatus" class="alert alert-info" style="margin-top: 15px;">
                    <span class="status-indicator status-info"></span>
                    WebRTCÂ∞±Áª™ÔºåÁ≠âÂæÖÊµãËØï
                </div>
            </div>
            
            <!-- ‰ª£ÁêÜÊúçÂä°Âô®ÊµãËØïÈù¢Êùø -->
            <div class="test-panel">
                <div class="panel-header">
                    <div class="panel-icon proxy-icon">üîÑ</div>
                    <div class="panel-title">‰ª£ÁêÜÊúçÂä°Âô®Êí≠Êîæ</div>
                </div>
                
                <div class="control-group">
                    <label>‰ª£ÁêÜÊúçÂä°Âô®Âú∞ÂùÄ:</label>
                    <input type="text" id="proxyServerUrl" value="http://localhost:3001" placeholder="http://localhost:3001">
                </div>
                
                <div class="control-group">
                    <label>ËßÜÈ¢ëÊ∫êURL:</label>
                    <input type="text" id="proxyVideoUrl" value="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4" placeholder="ËßÜÈ¢ëURL">
                </div>
                
                <div class="control-group">
                    <label>Êí≠ÊîæÊ®°Âºè:</label>
                    <select id="proxyMode">
                        <option value="proxy">‰ª£ÁêÜÊ®°Âºè</option>
                        <option value="transcode">ËΩ¨Á†ÅÊ®°Âºè</option>
                        <option value="stream">ÊµÅÂ™í‰ΩìÊ®°Âºè</option>
                    </select>
                </div>
                
                <button class="btn btn-primary" onclick="testProxy()">üöÄ ÊµãËØï‰ª£ÁêÜ</button>
                <button class="btn btn-warning" onclick="stopProxy()">‚èπÔ∏è ÂÅúÊ≠¢</button>
                
                <div id="proxyStatus" class="alert alert-info" style="margin-top: 15px;">
                    <span class="status-indicator status-info"></span>
                    ‰ª£ÁêÜÊúçÂä°Âô®Â∞±Áª™ÔºåÁ≠âÂæÖÊµãËØï
                </div>
            </div>
            
            <!-- ÊÄßËÉΩÁõëÊéßÈù¢Êùø -->
            <div class="test-panel">
                <div class="panel-header">
                    <div class="panel-icon performance-icon">üìä</div>
                    <div class="panel-title">ÊÄßËÉΩÁõëÊéß</div>
                </div>
                
                <div class="control-group">
                    <label>ÁõëÊéßÈó¥Èöî (ÊØ´Áßí):</label>
                    <input type="number" id="monitorInterval" value="1000" min="500" max="5000">
                </div>
                
                <div class="control-group">
                    <label>‰ºòÂåñÈó¥Èöî (ÊØ´Áßí):</label>
                    <input type="number" id="optimizeInterval" value="10000" min="5000" max="30000">
                </div>
                
                <button class="btn btn-success" onclick="startMonitoring()">üìà ÂºÄÂßãÁõëÊéß</button>
                <button class="btn btn-danger" onclick="stopMonitoring()">üìâ ÂÅúÊ≠¢ÁõëÊéß</button>
                <button class="btn btn-warning" onclick="resetMetrics()">üîÑ ÈáçÁΩÆÊåáÊ†á</button>
                
                <div id="monitoringStatus" class="alert alert-info" style="margin-top: 15px;">
                    <span class="status-indicator status-info"></span>
                    ÊÄßËÉΩÁõëÊéßÂ∞±Áª™
                </div>
            </div>
            
            <!-- Êô∫ËÉΩÈôçÁ∫ßÈù¢Êùø -->
            <div class="test-panel">
                <div class="panel-header">
                    <div class="panel-icon fallback-icon">üß†</div>
                    <div class="panel-title">Êô∫ËÉΩÈôçÁ∫ßÊµãËØï</div>
                </div>
                
                <div class="control-group">
                    <label>ÊµãËØïËßÜÈ¢ëURL:</label>
                    <input type="text" id="fallbackVideoUrl" value="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerBlazes.mp4" placeholder="ËßÜÈ¢ëURL">
                </div>
                
                <div class="control-group">
                    <label>ÈôçÁ∫ßÁ≠ñÁï•:</label>
                    <select id="fallbackStrategy">
                        <option value="auto">Ëá™Âä®ÈÄâÊã©</option>
                        <option value="quality_first">Ë¥®Èáè‰ºòÂÖà</option>
                        <option value="speed_first">ÈÄüÂ∫¶‰ºòÂÖà</option>
                        <option value="compatibility_first">ÂÖºÂÆπÊÄß‰ºòÂÖà</option>
                    </select>
                </div>
                
                <button class="btn btn-primary" onclick="testFallback()">üß† Êô∫ËÉΩÊí≠Êîæ</button>
                <button class="btn btn-warning" onclick="stopFallback()">‚èπÔ∏è ÂÅúÊ≠¢</button>
                
                <div id="fallbackStatus" class="alert alert-info" style="margin-top: 15px;">
                    <span class="status-indicator status-info"></span>
                    Êô∫ËÉΩÈôçÁ∫ßÂ∞±Áª™
                </div>
            </div>
        </div>
        
        <!-- ËßÜÈ¢ëÊí≠ÊîæÂå∫Âüü -->
        <div class="video-container">
            <h3>üì∫ ËßÜÈ¢ëÊí≠ÊîæÂå∫Âüü</h3>
            <div class="video-wrapper">
                <video id="testVideo" controls>
                    ÊÇ®ÁöÑÊµèËßàÂô®‰∏çÊîØÊåÅËßÜÈ¢ëÊí≠Êîæ„ÄÇ
                </video>
                <div id="videoOverlay" class="video-overlay">
                    <div>Á≠âÂæÖÊí≠Êîæ...</div>
                </div>
            </div>
            
            <div class="control-group">
                <button class="btn btn-success" onclick="playVideo()">‚ñ∂Ô∏è Êí≠Êîæ</button>
                <button class="btn btn-warning" onclick="pauseVideo()">‚è∏Ô∏è ÊöÇÂÅú</button>
                <button class="btn btn-danger" onclick="stopVideo()">‚èπÔ∏è ÂÅúÊ≠¢</button>
                <button class="btn btn-primary" onclick="toggleFullscreen()">üîç ÂÖ®Â±è</button>
            </div>
        </div>
        
        <!-- ÊÄßËÉΩÊåáÊ†áÊòæÁ§∫ -->
        <div class="video-container">
            <h3>üìä ÂÆûÊó∂ÊÄßËÉΩÊåáÊ†á</h3>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value" id="bandwidthMetric">0</div>
                    <div class="metric-label">Â∏¶ÂÆΩ (Mbps)</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="fpsMetric">0</div>
                    <div class="metric-label">Â∏ßÁéá (FPS)</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="latencyMetric">0</div>
                    <div class="metric-label">Âª∂Ëøü (ms)</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="cpuMetric">0</div>
                    <div class="metric-label">CPU (%)</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="memoryMetric">0</div>
                    <div class="metric-label">ÂÜÖÂ≠ò (%)</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="scoreMetric">0</div>
                    <div class="metric-label">ÊÄª‰ΩìËØÑÂàÜ</div>
                </div>
            </div>
            
            <div class="progress-bar">
                <div id="performanceProgress" class="progress-fill"></div>
            </div>
        </div>
        
        <!-- Êó•ÂøóÊòæÁ§∫Âå∫Âüü -->
        <div class="log-container">
            <div class="log-header">
                <h3>üìã Á≥ªÁªüÊó•Âøó</h3>
                <div>
                    <button class="btn btn-warning" onclick="clearLogs()">üóëÔ∏è Ê∏ÖÁ©∫Êó•Âøó</button>
                    <button class="btn btn-primary" onclick="exportLogs()">üíæ ÂØºÂá∫Êó•Âøó</button>
                </div>
            </div>
            <div id="logContent" class="log-content">
                <div class="log-entry log-info">[INFO] TeslaÊµãËØïÂ•ó‰ª∂Â∑≤Âä†ËΩΩ</div>
            </div>
        </div>
    </div>
    
    <!-- ÂºïÂÖ•ÊâÄÊúâÂøÖË¶ÅÁöÑËÑöÊú¨ -->
    <script src="js/tesla-webrtc-player.js"></script>
    <script src="js/tesla-proxy-client.js"></script>
    <script src="js/tesla-performance-monitor.js"></script>
    <script src="js/tesla-fallback-manager.js"></script>
    
    <script>
        // ÂÖ®Â±ÄÂèòÈáè
        let webrtcPlayer = null;
        let proxyClient = null;
        let performanceMonitor = null;
        let fallbackManager = null;
        let currentMethod = null;
        
        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            initializeTestSuite();
        });
        
        /**
         * ÂàùÂßãÂåñÊµãËØïÂ•ó‰ª∂
         */
        function initializeTestSuite() {
            log('ÂàùÂßãÂåñTeslaÊµãËØïÂ•ó‰ª∂...', 'info');
            
            // ÂàùÂßãÂåñ‰ª£ÁêÜÂÆ¢Êà∑Á´Ø
            proxyClient = new TeslaProxyClient({
                serverUrl: 'http://localhost:3001',
                debug: true
            });
            
            // ÂàùÂßãÂåñÊÄßËÉΩÁõëÊéßÂô®
            performanceMonitor = new TeslaPerformanceMonitor({
                debug: true,
                monitoringInterval: 1000,
                optimizationInterval: 10000,
                onMetricsUpdate: updateMetricsDisplay,
                onPerformanceAlert: handlePerformanceAlert,
                onOptimizationApplied: handleOptimizationApplied
            });
            
            // ÂàùÂßãÂåñÊô∫ËÉΩÈôçÁ∫ßÁÆ°ÁêÜÂô®
            fallbackManager = new TeslaFallbackManager({
                debug: true,
                onMethodSelected: handleMethodSelected,
                onMethodFailed: handleMethodFailed,
                onFallbackComplete: handleFallbackComplete
            });
            
            log('ÊµãËØïÂ•ó‰ª∂ÂàùÂßãÂåñÂÆåÊàê', 'success');
        }
        
        /**
         * ÊµãËØïWebRTC
         */
        async function testWebRTC() {
            try {
                log('ÂºÄÂßãWebRTCÊµãËØï...', 'info');
                updateStatus('webrtcStatus', 'Ê≠£Âú®ËøûÊé•WebRTC...', 'warning');
                
                const signalServerUrl = document.getElementById('signalServerUrl').value;
                const videoUrl = document.getElementById('webrtcVideoUrl').value;
                
                // ÂàõÂª∫WebRTCÊí≠ÊîæÂô®
                webrtcPlayer = new TeslaWebRTCPlayer({
                    signalServerUrl: signalServerUrl,
                    debug: true
                });
                
                // ËøûÊé•Âπ∂Êí≠Êîæ
                await webrtcPlayer.connect();
                await webrtcPlayer.play(videoUrl, document.getElementById('testVideo'));
                
                currentMethod = 'webrtc';
                updateStatus('webrtcStatus', 'WebRTCËøûÊé•ÊàêÂäüÔºåÊ≠£Âú®Êí≠Êîæ', 'success');
                hideVideoOverlay();
                
                log('WebRTCÊµãËØïÊàêÂäü', 'success');
                
            } catch (error) {
                log(`WebRTCÊµãËØïÂ§±Ë¥•: ${error.message}`, 'error');
                updateStatus('webrtcStatus', `WebRTCËøûÊé•Â§±Ë¥•: ${error.message}`, 'error');
            }
        }
        
        /**
         * ÂÅúÊ≠¢WebRTC
         */
        function stopWebRTC() {
            if (webrtcPlayer) {
                webrtcPlayer.disconnect();
                webrtcPlayer = null;
                currentMethod = null;
                updateStatus('webrtcStatus', 'WebRTCÂ∑≤ÂÅúÊ≠¢', 'info');
                showVideoOverlay('WebRTCÂ∑≤ÂÅúÊ≠¢');
                log('WebRTCÂ∑≤ÂÅúÊ≠¢', 'info');
            }
        }
        
        /**
         * ÊµãËØï‰ª£ÁêÜÊúçÂä°Âô®
         */
        async function testProxy() {
            try {
                log('ÂºÄÂßã‰ª£ÁêÜÊúçÂä°Âô®ÊµãËØï...', 'info');
                updateStatus('proxyStatus', 'Ê≠£Âú®ËøûÊé•‰ª£ÁêÜÊúçÂä°Âô®...', 'warning');
                
                const serverUrl = document.getElementById('proxyServerUrl').value;
                const videoUrl = document.getElementById('proxyVideoUrl').value;
                const mode = document.getElementById('proxyMode').value;
                
                // Êõ¥Êñ∞‰ª£ÁêÜÂÆ¢Êà∑Á´ØÈÖçÁΩÆ
                proxyClient.serverUrl = serverUrl;
                
                // Ê£ÄÊü•ÊúçÂä°Âô®Áä∂ÊÄÅ
                const status = await proxyClient.checkServerStatus();
                if (!status.available) {
                    throw new Error('‰ª£ÁêÜÊúçÂä°Âô®‰∏çÂèØÁî®');
                }
                
                // Ê†πÊçÆÊ®°ÂºèÁîüÊàêURL
                let proxyUrl;
                switch (mode) {
                    case 'transcode':
                        proxyUrl = proxyClient.getTranscodeUrl(videoUrl, 'tesla_optimized');
                        break;
                    case 'stream':
                        proxyUrl = proxyClient.getStreamUrl(videoUrl);
                        break;
                    default:
                        proxyUrl = proxyClient.getProxyUrl(videoUrl);
                }
                
                // Êí≠ÊîæËßÜÈ¢ë
                const video = document.getElementById('testVideo');
                video.src = proxyUrl;
                await video.play();
                
                currentMethod = 'proxy';
                updateStatus('proxyStatus', `‰ª£ÁêÜÊúçÂä°Âô®ËøûÊé•ÊàêÂäü (${mode}Ê®°Âºè)`, 'success');
                hideVideoOverlay();
                
                log(`‰ª£ÁêÜÊúçÂä°Âô®ÊµãËØïÊàêÂäü (${mode}Ê®°Âºè)`, 'success');
                
            } catch (error) {
                log(`‰ª£ÁêÜÊúçÂä°Âô®ÊµãËØïÂ§±Ë¥•: ${error.message}`, 'error');
                updateStatus('proxyStatus', `‰ª£ÁêÜÊúçÂä°Âô®ËøûÊé•Â§±Ë¥•: ${error.message}`, 'error');
            }
        }
        
        /**
         * ÂÅúÊ≠¢‰ª£ÁêÜÊí≠Êîæ
         */
        function stopProxy() {
            const video = document.getElementById('testVideo');
            video.pause();
            video.src = '';
            currentMethod = null;
            updateStatus('proxyStatus', '‰ª£ÁêÜÊí≠ÊîæÂ∑≤ÂÅúÊ≠¢', 'info');
            showVideoOverlay('‰ª£ÁêÜÊí≠ÊîæÂ∑≤ÂÅúÊ≠¢');
            log('‰ª£ÁêÜÊí≠ÊîæÂ∑≤ÂÅúÊ≠¢', 'info');
        }
        
        /**
         * ÂºÄÂßãÊÄßËÉΩÁõëÊéß
         */
        function startMonitoring() {
            const video = document.getElementById('testVideo');
            const monitorInterval = parseInt(document.getElementById('monitorInterval').value);
            const optimizeInterval = parseInt(document.getElementById('optimizeInterval').value);
            
            performanceMonitor.monitoringInterval = monitorInterval;
            performanceMonitor.optimizationInterval = optimizeInterval;
            
            performanceMonitor.startMonitoring(video, getCurrentPlayer());
            
            updateStatus('monitoringStatus', 'ÊÄßËÉΩÁõëÊéßÂ∑≤ÂêØÂä®', 'success');
            log('ÊÄßËÉΩÁõëÊéßÂ∑≤ÂêØÂä®', 'success');
        }
        
        /**
         * ÂÅúÊ≠¢ÊÄßËÉΩÁõëÊéß
         */
        function stopMonitoring() {
            performanceMonitor.stopMonitoring();
            updateStatus('monitoringStatus', 'ÊÄßËÉΩÁõëÊéßÂ∑≤ÂÅúÊ≠¢', 'info');
            log('ÊÄßËÉΩÁõëÊéßÂ∑≤ÂÅúÊ≠¢', 'info');
        }
        
        /**
         * ÈáçÁΩÆÊÄßËÉΩÊåáÊ†á
         */
        function resetMetrics() {
            performanceMonitor.resetMetrics();
            updateMetricsDisplay({
                bandwidth: { current: 0 },
                playback: { fps: 0, latency: 0 },
                system: { cpu: 0, memory: 0 },
                experience: { userSatisfaction: 0 }
            });
            log('ÊÄßËÉΩÊåáÊ†áÂ∑≤ÈáçÁΩÆ', 'info');
        }
        
        /**
         * ÊµãËØïÊô∫ËÉΩÈôçÁ∫ß
         */
        async function testFallback() {
            try {
                log('ÂºÄÂßãÊô∫ËÉΩÈôçÁ∫ßÊµãËØï...', 'info');
                updateStatus('fallbackStatus', 'Ê≠£Âú®ÂàÜÊûêÊúÄ‰Ω≥Êí≠ÊîæÊñπÊ°à...', 'warning');
                
                const videoUrl = document.getElementById('fallbackVideoUrl').value;
                const strategy = document.getElementById('fallbackStrategy').value;
                
                // ÊâßË°åÊô∫ËÉΩÈôçÁ∫ßÊí≠Êîæ
                await fallbackManager.executeWithFallback(videoUrl, async (method, url, options) => {
                    log(`Â∞ùËØïÊí≠ÊîæÊñπÊ°à: ${method.name}`, 'info');
                    
                    switch (method.name) {
                        case 'webrtc':
                            return await playWithWebRTC(url);
                        case 'proxy':
                        case 'transcode':
                            return await playWithProxy(url, method.name);
                        case 'direct':
                            return await playDirect(url);
                        default:
                            throw new Error(`Êú™Áü•ÁöÑÊí≠ÊîæÊñπÊ°à: ${method.name}`);
                    }
                }, { strategy });
                
                updateStatus('fallbackStatus', 'Êô∫ËÉΩÈôçÁ∫ßÊí≠ÊîæÊàêÂäü', 'success');
                hideVideoOverlay();
                
            } catch (error) {
                log(`Êô∫ËÉΩÈôçÁ∫ßÊµãËØïÂ§±Ë¥•: ${error.message}`, 'error');
                updateStatus('fallbackStatus', `Êô∫ËÉΩÈôçÁ∫ßÂ§±Ë¥•: ${error.message}`, 'error');
            }
        }
        
        /**
         * ÂÅúÊ≠¢Êô∫ËÉΩÈôçÁ∫ß
         */
        function stopFallback() {
            stopVideo();
            updateStatus('fallbackStatus', 'Êô∫ËÉΩÈôçÁ∫ßÂ∑≤ÂÅúÊ≠¢', 'info');
            log('Êô∫ËÉΩÈôçÁ∫ßÂ∑≤ÂÅúÊ≠¢', 'info');
        }
        
        /**
         * ‰ΩøÁî®WebRTCÊí≠Êîæ
         */
        async function playWithWebRTC(url) {
            if (!webrtcPlayer) {
                webrtcPlayer = new TeslaWebRTCPlayer({
                    signalServerUrl: document.getElementById('signalServerUrl').value,
                    debug: true
                });
                await webrtcPlayer.connect();
            }
            
            await webrtcPlayer.play(url, document.getElementById('testVideo'));
            currentMethod = 'webrtc';
            return 'webrtc';
        }
        
        /**
         * ‰ΩøÁî®‰ª£ÁêÜÊí≠Êîæ
         */
        async function playWithProxy(url, mode) {
            let proxyUrl;
            
            switch (mode) {
                case 'transcode':
                    proxyUrl = proxyClient.getTranscodeUrl(url, 'tesla_optimized');
                    break;
                default:
                    proxyUrl = proxyClient.getProxyUrl(url);
            }
            
            const video = document.getElementById('testVideo');
            video.src = proxyUrl;
            await video.play();
            
            currentMethod = 'proxy';
            return 'proxy';
        }
        
        /**
         * Áõ¥Êé•Êí≠Êîæ
         */
        async function playDirect(url) {
            const video = document.getElementById('testVideo');
            video.src = url;
            await video.play();
            
            currentMethod = 'direct';
            return 'direct';
        }
        
        /**
         * Ëé∑ÂèñÂΩìÂâçÊí≠ÊîæÂô®
         */
        function getCurrentPlayer() {
            switch (currentMethod) {
                case 'webrtc':
                    return webrtcPlayer;
                case 'proxy':
                    return proxyClient;
                default:
                    return null;
            }
        }
        
        /**
         * ËßÜÈ¢ëÊéßÂà∂ÂáΩÊï∞
         */
        function playVideo() {
            const video = document.getElementById('testVideo');
            video.play();
            log('ËßÜÈ¢ëÊí≠Êîæ', 'info');
        }
        
        function pauseVideo() {
            const video = document.getElementById('testVideo');
            video.pause();
            log('ËßÜÈ¢ëÊöÇÂÅú', 'info');
        }
        
        function stopVideo() {
            const video = document.getElementById('testVideo');
            video.pause();
            video.currentTime = 0;
            showVideoOverlay('ËßÜÈ¢ëÂ∑≤ÂÅúÊ≠¢');
            log('ËßÜÈ¢ëÂÅúÊ≠¢', 'info');
        }
        
        function toggleFullscreen() {
            const video = document.getElementById('testVideo');
            if (video.requestFullscreen) {
                video.requestFullscreen();
            } else if (video.webkitRequestFullscreen) {
                video.webkitRequestFullscreen();
            } else if (video.msRequestFullscreen) {
                video.msRequestFullscreen();
            }
        }
        
        /**
         * Êõ¥Êñ∞Áä∂ÊÄÅÊòæÁ§∫
         */
        function updateStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            const indicator = element.querySelector('.status-indicator');
            
            element.className = `alert alert-${type}`;
            indicator.className = `status-indicator status-${type}`;
            
            // Êõ¥Êñ∞ÊñáÊú¨Ôºå‰øùÁïôÁä∂ÊÄÅÊåáÁ§∫Âô®
            const textNode = element.childNodes[element.childNodes.length - 1];
            if (textNode.nodeType === Node.TEXT_NODE) {
                textNode.textContent = message;
            } else {
                element.appendChild(document.createTextNode(message));
            }
        }
        
        /**
         * ÊòæÁ§∫/ÈöêËóèËßÜÈ¢ëË¶ÜÁõñÂ±Ç
         */
        function showVideoOverlay(message) {
            const overlay = document.getElementById('videoOverlay');
            overlay.querySelector('div').textContent = message;
            overlay.classList.add('show');
        }
        
        function hideVideoOverlay() {
            const overlay = document.getElementById('videoOverlay');
            overlay.classList.remove('show');
        }
        
        /**
         * Êõ¥Êñ∞ÊÄßËÉΩÊåáÊ†áÊòæÁ§∫
         */
        function updateMetricsDisplay(metrics) {
            document.getElementById('bandwidthMetric').textContent = 
                (metrics.bandwidth.current / 1000000).toFixed(1);
            document.getElementById('fpsMetric').textContent = 
                metrics.playback.fps.toFixed(0);
            document.getElementById('latencyMetric').textContent = 
                metrics.playback.latency.toFixed(0);
            document.getElementById('cpuMetric').textContent = 
                metrics.system.cpu.toFixed(0);
            document.getElementById('memoryMetric').textContent = 
                metrics.system.memory.toFixed(0);
            
            // ËÆ°ÁÆóÊÄª‰ΩìËØÑÂàÜ
            const score = performanceMonitor.calculateOverallScore();
            document.getElementById('scoreMetric').textContent = score;
            
            // Êõ¥Êñ∞ËøõÂ∫¶Êù°
            const progressBar = document.getElementById('performanceProgress');
            progressBar.style.width = `${score}%`;
        }
        
        /**
         * Â§ÑÁêÜÊÄßËÉΩË≠¶Âëä
         */
        function handlePerformanceAlert(alerts) {
            alerts.forEach(alert => {
                log(`ÊÄßËÉΩË≠¶Âëä: ${alert.message} (${alert.value}/${alert.threshold})`, 'warning');
            });
        }
        
        /**
         * Â§ÑÁêÜ‰ºòÂåñÂ∫îÁî®
         */
        function handleOptimizationApplied(optimizations) {
            optimizations.forEach(opt => {
                log(`Â∫îÁî®‰ºòÂåñ: ${opt.type} (${opt.reason})`, 'success');
            });
        }
        
        /**
         * Â§ÑÁêÜÊñπÊ°àÈÄâÊã©
         */
        function handleMethodSelected(method) {
            log(`ÈÄâÊã©Êí≠ÊîæÊñπÊ°à: ${method.name} - ${method.description}`, 'info');
        }
        
        /**
         * Â§ÑÁêÜÊñπÊ°àÂ§±Ë¥•
         */
        function handleMethodFailed(info) {
            log(`Êí≠ÊîæÊñπÊ°àÂ§±Ë¥•: ${info.method.name} - ${info.error.message}`, 'warning');
        }
        
        /**
         * Â§ÑÁêÜÈôçÁ∫ßÂÆåÊàê
         */
        function handleFallbackComplete(result) {
            if (result.success) {
                log(`ÈôçÁ∫ßÊàêÂäü: ‰ΩøÁî®ÊñπÊ°à ${result.method.name}`, 'success');
            } else {
                log(`ÈôçÁ∫ßÂ§±Ë¥•: ${result.error.message}`, 'error');
            }
        }
        
        /**
         * Êó•ÂøóÂáΩÊï∞
         */
        function log(message, type = 'info') {
            const logContent = document.getElementById('logContent');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            
            logEntry.className = `log-entry log-${type}`;
            logEntry.textContent = `[${timestamp}] [${type.toUpperCase()}] ${message}`;
            
            logContent.appendChild(logEntry);
            logContent.scrollTop = logContent.scrollHeight;
            
            // ÈôêÂà∂Êó•ÂøóÊù°Êï∞
            const entries = logContent.querySelectorAll('.log-entry');
            if (entries.length > 100) {
                entries[0].remove();
            }
        }
        
        /**
         * Ê∏ÖÁ©∫Êó•Âøó
         */
        function clearLogs() {
            const logContent = document.getElementById('logContent');
            logContent.innerHTML = '<div class="log-entry log-info">[INFO] Êó•ÂøóÂ∑≤Ê∏ÖÁ©∫</div>';
        }
        
        /**
         * ÂØºÂá∫Êó•Âøó
         */
        function exportLogs() {
            const logContent = document.getElementById('logContent');
            const logs = Array.from(logContent.querySelectorAll('.log-entry'))
                .map(entry => entry.textContent)
                .join('\n');
            
            const blob = new Blob([logs], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `tesla-test-logs-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.txt`;
            a.click();
            
            URL.revokeObjectURL(url);
            log('Êó•ÂøóÂ∑≤ÂØºÂá∫', 'success');
        }
    </script>
</body>
</html>